<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-docs/concepts/rgd/static-type-checking" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">Static Analysis | kro</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://kro.run/kro/img/kro.svg"><meta data-rh="true" name="twitter:image" content="https://kro.run/kro/img/kro.svg"><meta data-rh="true" property="og:url" content="https://kro.run/kro/next/docs/concepts/rgd/static-type-checking"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Static Analysis | kro"><meta data-rh="true" name="description" content="One of kro&#x27;s most powerful features is static analysis. When you create or update a ResourceGraphDefinition, kro performs extensive validation before accepting it. This analysis happens during RGD reconciliation - before any instances of your custom resource are created."><meta data-rh="true" property="og:description" content="One of kro&#x27;s most powerful features is static analysis. When you create or update a ResourceGraphDefinition, kro performs extensive validation before accepting it. This analysis happens during RGD reconciliation - before any instances of your custom resource are created."><link data-rh="true" rel="icon" href="/kro/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kro.run/kro/next/docs/concepts/rgd/static-type-checking"><link data-rh="true" rel="alternate" href="https://kro.run/kro/next/docs/concepts/rgd/static-type-checking" hreflang="en"><link data-rh="true" rel="alternate" href="https://kro.run/kro/next/docs/concepts/rgd/static-type-checking" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Static Analysis","item":"https://kro.run/kro/next/docs/concepts/rgd/static-type-checking"}]}</script><meta name="go-import" content="kro.run/pkg git https://github.com/kubernetes-sigs/kro">
<meta name="go-source" content="kro.run/pkg git https://github.com/kubernetes-sigs/kro https://github.com/kubernetes-sigs/kro/tree/main{/dir} https://github.com/kubernetes-sigs/kro/blob/main{/dir}/{file}#L{line}"><link rel="stylesheet" href="/kro/assets/css/styles.5d887e16.css">
<script src="/kro/assets/js/runtime~main.0285ca76.js" defer="defer"></script>
<script src="/kro/assets/js/main.6d120dbe.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/kro/"><b class="navbar__title text--truncate">kro</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/kro/next/docs/overview">Documentation</a><a class="navbar__item navbar__link" href="/kro/next/api/reference">Reference</a><a class="navbar__item navbar__link" href="/kro/next/examples/">Examples</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/kro/next/docs/concepts/rgd/static-type-checking">main</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/kro/next/docs/concepts/rgd/static-type-checking">main</a></li><li><a class="dropdown__link" href="/kro/docs/concepts/rgd/static-type-checking">0.7.1</a></li><li><a class="dropdown__link" href="/kro/0.7.0/docs/concepts/rgd/static-type-checking">0.7.0</a></li><li><a class="dropdown__link" href="/kro/0.6.3/docs/overview">0.6.3</a></li><li><a class="dropdown__link" href="/kro/0.6.2/docs/overview">0.6.2</a></li><li><a class="dropdown__link" href="/kro/0.6.1/docs/overview">0.6.1</a></li><li><a class="dropdown__link" href="/kro/0.6.0/docs/overview">0.6.0</a></li><li><a class="dropdown__link" href="/kro/0.5.1/docs/overview">0.5.1</a></li><li><a class="dropdown__link" href="/kro/0.5.0/docs/overview">0.5.0</a></li><li><a class="dropdown__link" href="/kro/0.4.1/docs/overview">0.4.1</a></li><li><a class="dropdown__link" href="/kro/0.4.0/docs/overview">0.4.0</a></li><li><a class="dropdown__link" href="/kro/0.3.0/docs/overview">0.3.0</a></li><li><a class="dropdown__link" href="/kro/0.2.2/docs/overview">0.2.2</a></li><li><a class="dropdown__link" href="/kro/0.2.1/docs/overview">0.2.1</a></li><li><a class="dropdown__link" href="/kro/0.2.0/docs/overview">0.2.0</a></li><li><a class="dropdown__link" href="/kro/0.1.0/docs/overview">0.1.0</a></li><li class=""><hr class="dropdown-separator"></li><li><a class="dropdown__link" href="/kro/versions">All versions</a></li></ul></div><a href="https://github.com/kubernetes-sigs/kro" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/kro/"><b>kro</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/kro/next/docs/overview"><span title="What is kro?" class="linkLabel_WmDU">What is kro?</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/kro/next/docs/getting-started/Installation"><span title="Getting started" class="categoryLinkLabel_W154">Getting started</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kro/next/docs/getting-started/Installation"><span title="Installing kro" class="linkLabel_WmDU">Installing kro</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kro/next/docs/getting-started/deploy-a-resource-graph-definition"><span title="Quick Start" class="linkLabel_WmDU">Quick Start</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/kro/next/docs/concepts/rgd/overview"><span title="Concepts" class="categoryLinkLabel_W154">Concepts</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/kro/next/docs/concepts/rgd/overview"><span title="ResourceGraphDefinitions" class="categoryLinkLabel_W154">ResourceGraphDefinitions</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/kro/next/docs/concepts/rgd/overview"><span title="Overview" class="linkLabel_WmDU">Overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/kro/next/docs/concepts/rgd/schema"><span title="Schema Definition" class="linkLabel_WmDU">Schema Definition</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/kro/next/docs/concepts/rgd/resource-definitions/resource-basics"><span title="Resource Definitions" class="categoryLinkLabel_W154">Resource Definitions</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/kro/next/docs/concepts/rgd/resource-definitions/resource-basics"><span title="Basics" class="linkLabel_WmDU">Basics</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/kro/next/docs/concepts/rgd/resource-definitions/conditional-creation"><span title="Conditionals" class="linkLabel_WmDU">Conditionals</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/kro/next/docs/concepts/rgd/resource-definitions/readiness"><span title="Readiness" class="linkLabel_WmDU">Readiness</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/kro/next/docs/concepts/rgd/resource-definitions/collections"><span title="Collections" class="linkLabel_WmDU">Collections</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/kro/next/docs/concepts/rgd/resource-definitions/external-references"><span title="External References" class="linkLabel_WmDU">External References</span></a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/kro/next/docs/concepts/rgd/cel-expressions"><span title="CEL Expressions" class="linkLabel_WmDU">CEL Expressions</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/kro/next/docs/concepts/rgd/dependencies-ordering"><span title="Graph Inference" class="linkLabel_WmDU">Graph Inference</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/kro/next/docs/concepts/rgd/static-type-checking"><span title="Static Analysis" class="linkLabel_WmDU">Static Analysis</span></a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kro/next/docs/concepts/instances"><span title="Instances" class="linkLabel_WmDU">Instances</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/kro/next/docs/advanced/access-control"><span title="Advanced" class="categoryLinkLabel_W154">Advanced</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kro/next/docs/advanced/access-control"><span title="Access Control" class="linkLabel_WmDU">Access Control</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kro/next/docs/advanced/rgd-chaining"><span title="RGD Chaining" class="linkLabel_WmDU">RGD Chaining</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kro/next/docs/advanced/controller-tuning"><span title="Controller Tuning" class="linkLabel_WmDU">Controller Tuning</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kro/next/docs/advanced/metrics"><span title="Controller Metrics" class="linkLabel_WmDU">Controller Metrics</span></a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/kro/next/docs/faq"><span title="FAQ" class="linkLabel_WmDU">FAQ</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->kro<!-- --> <b>main</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/kro/docs/concepts/rgd/static-type-checking">latest version</a></b> (<!-- -->0.7.1<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/kro/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Concepts</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">ResourceGraphDefinitions</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Static Analysis</span></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: main</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Static Analysis</h1></header>
<p>One of kro&#x27;s most powerful features is <strong>static analysis</strong>. When you create or update a ResourceGraphDefinition, kro performs extensive validation before accepting it. This analysis happens during RGD reconciliation - before any instances of your custom resource are created.</p>
<p>Static analysis catches errors early: invalid CEL syntax, references to non-existent resources or fields, type mismatches, circular dependencies, and schema violations. Without this upfront validation, these errors would only surface during reconciliation when kro attempts to create resources in your cluster. This means immediate feedback during development instead of runtime failures.</p>
<p>kro achieves this by integrating directly with Kubernetes OpenAPI schemas. For every resource in your graph - whether built-in types like Deployments or custom CRDs - kro fetches the schema and validates your templates against it. This ensures CEL expressions reference actual fields, output types match target field expectations, and your entire resource graph is structurally sound.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="the-validation-process">The Validation Process<a href="#the-validation-process" class="hash-link" aria-label="Direct link to The Validation Process" title="Direct link to The Validation Process" translate="no">​</a></h2>
<p>When you create or update a ResourceGraphDefinition, kro performs validation in multiple stages:</p>
<div style="margin-top:3rem;margin-bottom:3rem"><p><img decoding="async" loading="lazy" alt="kro validation pipeline stages" src="/kro/assets/images/stages-eb9f2fdf6ce1ff557234ec4d34ea4c49.svg" width="2797" height="1157" class="img_ev3q"></p></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="stage-1-schema-validation">Stage 1: Schema Validation<a href="#stage-1-schema-validation" class="hash-link" aria-label="Direct link to Stage 1: Schema Validation" title="Direct link to Stage 1: Schema Validation" translate="no">​</a></h3>
<p>kro starts by validating your custom API schema:</p>
<ol>
<li><strong>Parses your SimpleSchema definition</strong> - Reads the schema from <code>spec.schema</code></li>
<li><strong>Converts to OpenAPI schema</strong> - Transforms SimpleSchema to standard OpenAPI format</li>
<li><strong>Validates the CRD spec</strong> - Ensures the generated CRD specification is valid</li>
</ol>
<div class="codeBlockContainer_X7hc"><div class="codeBlockContent_vqWU"><button class="copyButton_H_xL" title="Copy"><svg viewBox="0 0 24 24" class="copyIcon_el7_"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg></button><pre class="kroCodeBlock_J7AA"><code><span class="yamlKey_lCMJ">spec</span>:<!-- -->
<!-- -->  <span class="yamlKey_lCMJ">schema</span>:<!-- -->
<!-- -->    <span class="yamlKey_lCMJ">spec</span>:<!-- -->
<!-- -->      <span class="comment_cniX"># kro validates this schema definition</span>
<!-- -->      <span class="yamlKey_lCMJ">replicas</span>: <span class="schemaType_ZceW">integer</span><span class="schemaPipe_JhzG"> | </span><span class="schemaKeyword_VDfY">default</span><span class="schemaValue_rqRM">=3</span>
<!-- -->      <span class="yamlKey_lCMJ">ports</span>: <span class="schemaType_ZceW">array</span>
<!-- -->      <span class="yamlKey_lCMJ">labels</span>: <span class="schemaType_ZceW">object</span></code></pre></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="stage-2-status-schema-inference">Stage 2: Status Schema Inference<a href="#stage-2-status-schema-inference" class="hash-link" aria-label="Direct link to Stage 2: Status Schema Inference" title="Direct link to Stage 2: Status Schema Inference" translate="no">​</a></h3>
<p>For your custom API&#x27;s <code>status</code> field, kro automatically infers the schema from CEL expressions:</p>
<div class="codeBlockContainer_X7hc"><div class="codeBlockContent_vqWU"><button class="copyButton_H_xL" title="Copy"><svg viewBox="0 0 24 24" class="copyIcon_el7_"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg></button><pre class="kroCodeBlock_J7AA"><code><span class="yamlKey_lCMJ">status</span>:<!-- -->
<!-- -->  <span class="yamlKey_lCMJ">endpoint</span>: <span class="celExpression_MAYK">${service.status.loadBalancer.ingress[0].hostname}</span>
<!-- -->  <span class="yamlKey_lCMJ">replicas</span>: <span class="celExpression_MAYK">${deployment.status.availableReplicas}</span></code></pre></div></div>
<p>kro inspects these expressions, determines their output types, and generates the OpenAPI schema for your status field automatically. This means you don&#x27;t need to manually define status field types - kro figures them out from your CEL expressions.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="stage-3-resource-naming-validation">Stage 3: Resource Naming Validation<a href="#stage-3-resource-naming-validation" class="hash-link" aria-label="Direct link to Stage 3: Resource Naming Validation" title="Direct link to Stage 3: Resource Naming Validation" translate="no">​</a></h3>
<p>kro validates that all resource IDs are valid CEL identifiers. Resource IDs must be valid variable names in CEL - no hyphens, special characters, or starting with numbers.</p>
<p><strong>Why?</strong> CEL uses resource IDs as variables (like <code>${deployment.spec.replicas}</code>). Invalid identifiers would cause CEL syntax errors.</p>
<div class="codeBlockContainer_X7hc"><div class="codeBlockContent_vqWU"><button class="copyButton_H_xL" title="Copy"><svg viewBox="0 0 24 24" class="copyIcon_el7_"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg></button><pre class="kroCodeBlock_J7AA"><code><span class="comment_cniX"># ✓ Valid IDs</span>
<span class="yamlKey_lCMJ">resources</span>:<!-- -->
<!-- -->  <!-- -->- <span class="kroKeyword_GbQ5">id</span>: <!-- -->deployment<!-- -->
<!-- -->  <!-- -->- <span class="kroKeyword_GbQ5">id</span>: <!-- -->configMap<!-- -->
<!-- -->  <!-- -->- <span class="kroKeyword_GbQ5">id</span>: <!-- -->servicePrimary<!-- -->
<!-- -->
<span class="comment_cniX"># ✗ Invalid IDs</span>
<span class="yamlKey_lCMJ">resources</span>:<!-- -->
<!-- -->  <!-- -->- <span class="kroKeyword_GbQ5">id</span>: <!-- -->my-deployment  <span class="comment_cniX"># Hyphens not allowed (CEL subtraction operator)</span>
<!-- -->  <!-- -->- <span class="kroKeyword_GbQ5">id</span>: <!-- -->1st-service    <span class="comment_cniX"># Can&#x27;t start with number</span></code></pre></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="stage-4-resource-template-validation">Stage 4: Resource Template Validation<a href="#stage-4-resource-template-validation" class="hash-link" aria-label="Direct link to Stage 4: Resource Template Validation" title="Direct link to Stage 4: Resource Template Validation" translate="no">​</a></h3>
<p>For each resource template, kro:</p>
<ol>
<li><strong>Validates basic Kubernetes object structure</strong> - Ensures the template has required fields like <code>apiVersion</code>, <code>kind</code>, and <code>metadata</code></li>
<li><strong>Resolves the OpenAPI schema</strong> - Gets the schema from the API server for the resource type. This works for both built-in Kubernetes resources (like Deployments and Services) and Custom Resource Definitions installed in your cluster.</li>
<li><strong>Extracts CEL expressions and determines expected types</strong> - For each field in the template:<!-- -->
<ul>
<li><strong>If the field contains a CEL expression</strong>: kro extracts the expression and determines what type the target field expects based on the OpenAPI schema</li>
<li><strong>If the field is a literal value</strong>: kro performs standard OpenAPI validation, just like the kube-api-server does</li>
</ul>
</li>
</ol>
<div class="codeBlockContainer_X7hc"><div class="codeBlockContent_vqWU"><button class="copyButton_H_xL" title="Copy"><svg viewBox="0 0 24 24" class="copyIcon_el7_"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg></button><pre class="kroCodeBlock_J7AA"><code><span class="yamlKey_lCMJ">resources</span>:<!-- -->
<!-- -->  <!-- -->- <span class="kroKeyword_GbQ5">id</span>: <!-- -->deployment<!-- -->
<!-- -->    <span class="kroKeyword_GbQ5">template</span>:<!-- -->
<!-- -->      <span class="yamlKey_lCMJ">apiVersion</span>: <!-- -->apps/v1  <span class="comment_cniX"># kro fetches Deployment schema</span>
<!-- -->      <span class="yamlKey_lCMJ">kind</span>: <!-- -->Deployment<!-- -->
<!-- -->      <span class="comment_cniX"># ... validates template against Deployment schema</span></code></pre></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="stage-5-ast-analysis-and-dependency-graph-building">Stage 5: AST Analysis and Dependency Graph Building<a href="#stage-5-ast-analysis-and-dependency-graph-building" class="hash-link" aria-label="Direct link to Stage 5: AST Analysis and Dependency Graph Building" title="Direct link to Stage 5: AST Analysis and Dependency Graph Building" translate="no">​</a></h3>
<p>kro analyzes the Abstract Syntax Tree (AST) of all CEL expressions to understand how they reference each other:</p>
<ol>
<li><strong>Parses CEL expressions into ASTs</strong> - Converts each expression into its abstract syntax tree representation</li>
<li><strong>Analyzes references</strong> - Identifies what each expression references (schema fields, other resources, functions)</li>
<li><strong>Validates references</strong> - Checks that referenced resources exist in the DAG and functions are declared</li>
<li><strong>Builds the dependency graph</strong> - Creates a directed acyclic graph showing which resources depend on which</li>
<li><strong>Detects circular dependencies</strong> - Identifies any cycles in the dependency graph</li>
</ol>
<p>At this stage, kro already knows if you&#x27;re referencing something that doesn&#x27;t exist or using undeclared functions, and has detected any circular dependencies. See <a href="#cel-ast-parsing-and-dependency-detection">CEL AST Parsing and Dependency Detection</a> for technical details.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="stage-6-expression-type-checking">Stage 6: Expression Type Checking<a href="#stage-6-expression-type-checking" class="hash-link" aria-label="Direct link to Stage 6: Expression Type Checking" title="Direct link to Stage 6: Expression Type Checking" translate="no">​</a></h3>
<p>With expressions extracted and the dependency graph built, kro now performs comprehensive type checking on each CEL expression:</p>
<ol>
<li>
<p><strong>Type-checks the expression</strong> - kro uses CEL&#x27;s type checker to validate the expression against the typed environment containing all resource schemas. This verifies that all field accesses, function calls, and operations are valid and type-safe.</p>
</li>
<li>
<p><strong>Infers the expression&#x27;s output type</strong> - Based on the type checking results, kro determines what type the expression will produce. For <code>${schema.spec.replicas}</code>, kro infers an integer. For <code>${schema.spec.name + &quot;-deployment&quot;}</code>, kro infers a string.</p>
</li>
<li>
<p><strong>Validates type compatibility</strong> - kro compares the inferred output type against the expected type (determined earlier from the target field&#x27;s OpenAPI schema). First, it tries CEL&#x27;s built-in type assignability check. If that fails, it performs deep structural compatibility checking, which handles complex cases like map/struct conversions and subset validation. See <a href="#type-compatibility-deep-dive">Type Compatibility Deep Dive</a> for technical details.</p>
</li>
</ol>
<p><strong>Example:</strong></p>
<div class="codeBlockContainer_X7hc"><div class="codeBlockContent_vqWU"><button class="copyButton_H_xL" title="Copy"><svg viewBox="0 0 24 24" class="copyIcon_el7_"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg></button><pre class="kroCodeBlock_J7AA"><code><span class="comment_cniX"># Expression: </span><span class="celExpression_MAYK">${schema.spec.replicas}</span>
<span class="comment_cniX"># Inferred output type: integer (from schema.spec definition)</span>
<span class="comment_cniX"># Expected type: integer (from Deployment.spec.replicas schema)</span>
<span class="comment_cniX"># Result: ✓ Compatible</span></code></pre></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="stage-7-condition-expression-validation">Stage 7: Condition Expression Validation<a href="#stage-7-condition-expression-validation" class="hash-link" aria-label="Direct link to Stage 7: Condition Expression Validation" title="Direct link to Stage 7: Condition Expression Validation" translate="no">​</a></h3>
<p>kro validates special condition expressions used in resource lifecycle control:</p>
<ol>
<li><strong>Validates <code>readyWhen</code> expressions</strong> - Ensures readiness conditions are valid CEL expressions that return boolean values</li>
<li><strong>Validates <code>includeWhen</code> expressions</strong> - Ensures conditional inclusion expressions are valid CEL expressions that return boolean values</li>
</ol>
<p>These conditions control when resources are considered ready and whether they should be created at all, so they must always return <code>true</code> or <code>false</code>.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="stage-8-rgd-activation">Stage 8: RGD Activation<a href="#stage-8-rgd-activation" class="hash-link" aria-label="Direct link to Stage 8: RGD Activation" title="Direct link to Stage 8: RGD Activation" translate="no">​</a></h3>
<p>If all validation stages pass, kro activates the ResourceGraphDefinition:</p>
<ol>
<li><strong>Infers topological order</strong> - Computes the order in which resources will be created based on the dependency graph</li>
<li><strong>Registers the CRD</strong> - Creates the Custom Resource Definition in the cluster for your new API</li>
<li><strong>Starts the microcontroller</strong> - Registers the controller that will reconcile instances of your custom resource</li>
<li><strong>Begins serving instances</strong> - Your ResourceGraphDefinition is now ready to accept instance creation requests</li>
</ol>
<p>At this point, the RGD is fully validated and operational. When users create instances of your custom API, kro will orchestrate the resources according to the validated graph.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="cel-ast-parsing-and-dependency-detection">CEL AST Parsing and Dependency Detection<a href="#cel-ast-parsing-and-dependency-detection" class="hash-link" aria-label="Direct link to CEL AST Parsing and Dependency Detection" title="Direct link to CEL AST Parsing and Dependency Detection" translate="no">​</a></h2>
<p>During Stage 5, kro parses every CEL expression into an Abstract Syntax Tree (AST) and analyzes how expressions reference each other. This enables kro to build a complete dependency graph and detect issues before any resources are created.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="how-ast-parsing-works">How AST Parsing Works<a href="#how-ast-parsing-works" class="hash-link" aria-label="Direct link to How AST Parsing Works" title="Direct link to How AST Parsing Works" translate="no">​</a></h3>
<p>When kro encounters a CEL expression like <code>${deployment.spec.replicas}</code>, it:</p>
<ol>
<li>
<p><strong>Parses the expression into an AST</strong> - The CEL parser breaks down the expression into its component parts: an identifier (<code>deployment</code>), a field access (<code>.spec</code>), and another field access (<code>.replicas</code>).</p>
</li>
<li>
<p><strong>Walks the AST to find references</strong> - kro traverses the tree to identify what the expression references:</p>
<ul>
<li>Root identifiers (<code>schema</code>, <code>deployment</code>, <code>configmap</code>, etc.)</li>
<li>Field accesses (<code>.spec</code>, <code>.data</code>, <code>.status</code>)</li>
<li>Function calls (<code>size()</code>, <code>string()</code>, etc.)</li>
<li>Operators (<code>+</code>, <code>*</code>, <code>?</code>, etc.)</li>
</ul>
</li>
<li>
<p><strong>Validates references exist</strong> - For each identifier found:</p>
<ul>
<li>If it&#x27;s <code>schema</code>, kro validates the field path exists in your custom schema</li>
<li>If it&#x27;s a resource ID, kro checks that resource is defined in the DAG</li>
<li>If it&#x27;s a function, kro validates it&#x27;s a declared CEL function</li>
</ul>
</li>
<li>
<p><strong>Builds dependency edges</strong> - When resource B references resource A, kro adds an edge A → B in the dependency graph</p>
</li>
</ol>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="dependency-graph-construction">Dependency Graph Construction<a href="#dependency-graph-construction" class="hash-link" aria-label="Direct link to Dependency Graph Construction" title="Direct link to Dependency Graph Construction" translate="no">​</a></h3>
<p>kro builds a directed acyclic graph (DAG) showing which resources depend on which:</p>
<div class="codeBlockContainer_X7hc"><div class="codeBlockContent_vqWU"><button class="copyButton_H_xL" title="Copy"><svg viewBox="0 0 24 24" class="copyIcon_el7_"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg></button><pre class="kroCodeBlock_J7AA"><code><span class="yamlKey_lCMJ">resources</span>:<!-- -->
<!-- -->  <!-- -->- <span class="kroKeyword_GbQ5">id</span>: <!-- -->configmap<!-- -->
<!-- -->    <span class="kroKeyword_GbQ5">template</span>:<!-- -->
<!-- -->      <span class="yamlKey_lCMJ">data</span>:<!-- -->
<!-- -->        <span class="yamlKey_lCMJ">key</span>: <span class="celExpression_MAYK">${schema.spec.value}</span>  <span class="comment_cniX"># depends on: schema</span>
<!-- -->
<!-- -->  <!-- -->- <span class="kroKeyword_GbQ5">id</span>: <!-- -->deployment<!-- -->
<!-- -->    <span class="kroKeyword_GbQ5">template</span>:<!-- -->
<!-- -->      <span class="yamlKey_lCMJ">spec</span>:<!-- -->
<!-- -->        <span class="yamlKey_lCMJ">replicas</span>: <span class="celExpression_MAYK">${schema.spec.replicas}</span>  <span class="comment_cniX"># depends on: schema</span>
<!-- -->        <span class="yamlKey_lCMJ">env</span>:<!-- -->
<!-- -->          <!-- -->- <span class="yamlKey_lCMJ">value</span>: <span class="celExpression_MAYK">${configmap.data.key}</span>    <span class="comment_cniX"># depends on: configmap</span></code></pre></div></div>
<p>kro builds this dependency graph:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#1f2937;--prism-background-color:#fafafa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#1f2937;background-color:#fafafa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#1f2937"><span class="token plain">schema</span><br></span><span class="token-line" style="color:#1f2937"><span class="token plain">  ├─→ configmap</span><br></span><span class="token-line" style="color:#1f2937"><span class="token plain">  └─→ deployment</span><br></span><span class="token-line" style="color:#1f2937"><span class="token plain">        └─→ configmap</span><br></span></code></pre></div></div>
<p>This graph determines:</p>
<ul>
<li><strong>Creation order</strong>: configmap before deployment</li>
<li><strong>Evaluation dependencies</strong>: deployment expressions can only be evaluated after configmap exists</li>
<li><strong>Circular dependency detection</strong>: kro validates there are no cycles</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="reference-validation">Reference Validation<a href="#reference-validation" class="hash-link" aria-label="Direct link to Reference Validation" title="Direct link to Reference Validation" translate="no">​</a></h3>
<p>kro validates all references during AST analysis:</p>
<p><strong>Resource references</strong>:</p>
<div class="codeBlockContainer_X7hc"><div class="codeBlockContent_vqWU"><button class="copyButton_H_xL" title="Copy"><svg viewBox="0 0 24 24" class="copyIcon_el7_"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg></button><pre class="kroCodeBlock_J7AA"><code><span class="comment_cniX"># ✓ Valid: deployment exists</span>
<span class="yamlKey_lCMJ">value</span>: <span class="celExpression_MAYK">${deployment.spec.replicas}</span>
<!-- -->
<span class="comment_cniX"># ✗ Invalid: typo in resource ID</span>
<span class="yamlKey_lCMJ">value</span>: <span class="celExpression_MAYK">${deployent.spec.replicas}</span>  <span class="comment_cniX"># Error: resource &#x27;deployent&#x27; not found</span></code></pre></div></div>
<p><strong>Function references</strong>:</p>
<div class="codeBlockContainer_X7hc"><div class="codeBlockContent_vqWU"><button class="copyButton_H_xL" title="Copy"><svg viewBox="0 0 24 24" class="copyIcon_el7_"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg></button><pre class="kroCodeBlock_J7AA"><code><span class="comment_cniX"># ✓ Valid: size() is a CEL builtin</span>
<span class="yamlKey_lCMJ">condition</span>: <span class="celExpression_MAYK">${schema.spec.items.size() &gt; 0}</span>
<!-- -->
<span class="comment_cniX"># ✗ Invalid: undefined function</span>
<span class="yamlKey_lCMJ">condition</span>: <span class="celExpression_MAYK">${schema.spec.items.length()}</span>  <span class="comment_cniX"># Error: function &#x27;length&#x27; not declared</span></code></pre></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="circular-dependency-detection">Circular Dependency Detection<a href="#circular-dependency-detection" class="hash-link" aria-label="Direct link to Circular Dependency Detection" title="Direct link to Circular Dependency Detection" translate="no">​</a></h3>
<p>kro detects circular dependencies by checking for cycles in the DAG:</p>
<div class="codeBlockContainer_X7hc"><div class="codeBlockContent_vqWU"><button class="copyButton_H_xL" title="Copy"><svg viewBox="0 0 24 24" class="copyIcon_el7_"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg></button><pre class="kroCodeBlock_J7AA"><code><span class="comment_cniX"># ✗ This fails validation</span>
<span class="yamlKey_lCMJ">resources</span>:<!-- -->
<!-- -->  <!-- -->- <span class="kroKeyword_GbQ5">id</span>: <!-- -->serviceA<!-- -->
<!-- -->    <span class="kroKeyword_GbQ5">template</span>:<!-- -->
<!-- -->      <span class="yamlKey_lCMJ">spec</span>:<!-- -->
<!-- -->        <span class="yamlKey_lCMJ">port</span>: <span class="celExpression_MAYK">${serviceB.spec.targetPort}</span>  <span class="comment_cniX"># A → B</span>
<!-- -->
<!-- -->  <!-- -->- <span class="kroKeyword_GbQ5">id</span>: <!-- -->serviceB<!-- -->
<!-- -->    <span class="kroKeyword_GbQ5">template</span>:<!-- -->
<!-- -->      <span class="yamlKey_lCMJ">spec</span>:<!-- -->
<!-- -->        <span class="yamlKey_lCMJ">targetPort</span>: <span class="celExpression_MAYK">${serviceA.spec.port}</span>  <span class="comment_cniX"># B → A (cycle!)</span></code></pre></div></div>
<p>Error: <code>circular dependency detected: serviceA → serviceB → serviceA</code></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="type-compatibility-deep-dive">Type Compatibility Deep Dive<a href="#type-compatibility-deep-dive" class="hash-link" aria-label="Direct link to Type Compatibility Deep Dive" title="Direct link to Type Compatibility Deep Dive" translate="no">​</a></h2>
<p>During Stage 6, kro performs deep structural type compatibility checking. This goes beyond simple type matching to handle complex Kubernetes schemas through recursive comparison of type structures.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="structural-compatibility">Structural Compatibility<a href="#structural-compatibility" class="hash-link" aria-label="Direct link to Structural Compatibility" title="Direct link to Structural Compatibility" translate="no">​</a></h3>
<p>kro doesn&#x27;t just check if types have the same name - it performs deep structural comparison:</p>
<p><strong>For primitives</strong>: Checks kind equality (int, string, bool, etc.)</p>
<p><strong>For lists</strong>: Recursively checks element type compatibility</p>
<div class="codeBlockContainer_X7hc"><div class="codeBlockContent_vqWU"><button class="copyButton_H_xL" title="Copy"><svg viewBox="0 0 24 24" class="copyIcon_el7_"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg></button><pre class="kroCodeBlock_J7AA"><code><span class="comment_cniX"># Expression returns: list&lt;int&gt;</span>
<span class="comment_cniX"># Field expects: list&lt;int&gt;</span>
<span class="comment_cniX"># Result: ✓ Compatible</span>
<!-- -->
<span class="comment_cniX"># Expression returns: list&lt;string&gt;</span>
<span class="comment_cniX"># Field expects: list&lt;int&gt;</span>
<span class="comment_cniX"># Result: ✗ Incompatible - element types don&#x27;t match</span></code></pre></div></div>
<p><strong>For maps</strong>: Recursively checks key and value type compatibility</p>
<div class="codeBlockContainer_X7hc"><div class="codeBlockContent_vqWU"><button class="copyButton_H_xL" title="Copy"><svg viewBox="0 0 24 24" class="copyIcon_el7_"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg></button><pre class="kroCodeBlock_J7AA"><code><span class="comment_cniX"># Expression returns: map&lt;string, int&gt;</span>
<span class="comment_cniX"># Field expects: map&lt;string, int&gt;</span>
<span class="comment_cniX"># Result: ✓ Compatible</span>
<!-- -->
<span class="comment_cniX"># Expression returns: map&lt;string, string&gt;</span>
<span class="comment_cniX"># Field expects: map&lt;string, int&gt;</span>
<span class="comment_cniX"># Result: ✗ Incompatible - value types don&#x27;t match</span></code></pre></div></div>
<p><strong>For structs</strong>: Validates that the output struct is a subset of the expected struct (subset semantics)</p>
<div class="codeBlockContainer_X7hc"><div class="codeBlockContent_vqWU"><button class="copyButton_H_xL" title="Copy"><svg viewBox="0 0 24 24" class="copyIcon_el7_"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg></button><pre class="kroCodeBlock_J7AA"><code><span class="comment_cniX"># Expression returns: {name: string, replicas: int}</span>
<span class="comment_cniX"># Field expects: {name: string, replicas: int}</span>
<span class="comment_cniX"># Result: ✓ Compatible (exact match)</span>
<!-- -->
<span class="comment_cniX"># Expression returns: {name: string}</span>
<span class="comment_cniX"># Field expects: {name: string, replicas: int}</span>
<span class="comment_cniX"># Result: ✓ Compatible (output is subset - missing fields are OK)</span>
<!-- -->
<span class="comment_cniX"># Expression returns: {name: string, replicas: int, extra: string}</span>
<span class="comment_cniX"># Field expects: {name: string, replicas: int}</span>
<span class="comment_cniX"># Result: ✗ Incompatible (output has extra field &#x27;extra&#x27; not in expected)</span></code></pre></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="mapstruct-compatibility">Map/Struct Compatibility<a href="#mapstruct-compatibility" class="hash-link" aria-label="Direct link to Map/Struct Compatibility" title="Direct link to Map/Struct Compatibility" translate="no">​</a></h3>
<p>Kubernetes often treats maps and structs interchangeably (like labels, annotations, data fields). kro handles this intelligently:</p>
<p><strong>Map → Struct assignment</strong>:</p>
<div class="codeBlockContainer_X7hc"><div class="codeBlockContent_vqWU"><button class="copyButton_H_xL" title="Copy"><svg viewBox="0 0 24 24" class="copyIcon_el7_"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg></button><pre class="kroCodeBlock_J7AA"><code><span class="comment_cniX"># Expression: </span><span class="celExpression_MAYK">${schema.spec.labels}</span> <span class="yamlKey_lCMJ">(type</span>: <!-- -->map&lt;string, string&gt;)<!-- -->
<span class="comment_cniX"># Target field: labels (type: struct with string fields)</span>
<span class="comment_cniX"># kro validates: map keys are strings, map values match struct field types</span>
<span class="comment_cniX"># Result: ✓ Compatible if all struct fields accept strings</span></code></pre></div></div>
<p><strong>Struct → Map assignment</strong>:</p>
<div class="codeBlockContainer_X7hc"><div class="codeBlockContent_vqWU"><button class="copyButton_H_xL" title="Copy"><svg viewBox="0 0 24 24" class="copyIcon_el7_"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg></button><pre class="kroCodeBlock_J7AA"><code><span class="comment_cniX"># Expression: </span><span class="celExpression_MAYK">${configmap.data}</span> <span class="yamlKey_lCMJ">(type</span>: <!-- -->struct with dynamic fields)<!-- -->
<span class="comment_cniX"># Target field: data (type: map&lt;string, string&gt;)</span>
<span class="comment_cniX"># kro validates: all struct fields are string-compatible</span>
<span class="comment_cniX"># Result: ✓ Compatible if struct → map conversion is valid</span></code></pre></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="nested-field-type-checking">Nested Field Type Checking<a href="#nested-field-type-checking" class="hash-link" aria-label="Direct link to Nested Field Type Checking" title="Direct link to Nested Field Type Checking" translate="no">​</a></h3>
<p>kro validates types at any depth by recursively walking the type structure:</p>
<div class="codeBlockContainer_X7hc"><div class="codeBlockContent_vqWU"><button class="copyButton_H_xL" title="Copy"><svg viewBox="0 0 24 24" class="copyIcon_el7_"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg></button><pre class="kroCodeBlock_J7AA"><code><span class="yamlKey_lCMJ">spec</span>:<!-- -->
<!-- -->  <span class="kroKeyword_GbQ5">template</span>:<!-- -->
<!-- -->    <span class="yamlKey_lCMJ">spec</span>:<!-- -->
<!-- -->      <span class="yamlKey_lCMJ">containers</span>:<!-- -->
<!-- -->        <!-- -->- <span class="yamlKey_lCMJ">env</span>:<!-- -->
<!-- -->            <!-- -->- <span class="yamlKey_lCMJ">name</span>: <!-- -->PORT<!-- -->
<!-- -->              <span class="comment_cniX"># Expression returns: int</span>
<!-- -->              <span class="comment_cniX"># Field path: spec.template.spec.containers[].env[].value</span>
<!-- -->              <span class="comment_cniX"># Field expects: string</span>
<!-- -->              <span class="comment_cniX"># kro resolves the full nested path and checks compatibility</span>
<!-- -->              <span class="yamlKey_lCMJ">value</span>: <span class="celExpression_MAYK">${schema.spec.port}</span>  <span class="comment_cniX"># ✗ Type error: int → string</span></code></pre></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="preserveunknownfields-handling">PreserveUnknownFields Handling<a href="#preserveunknownfields-handling" class="hash-link" aria-label="Direct link to PreserveUnknownFields Handling" title="Direct link to PreserveUnknownFields Handling" translate="no">​</a></h3>
<p>For fields with <code>x-kubernetes-preserve-unknown-fields: true</code>, kro uses permissive validation:</p>
<div class="codeBlockContainer_X7hc"><div class="codeBlockContent_vqWU"><button class="copyButton_H_xL" title="Copy"><svg viewBox="0 0 24 24" class="copyIcon_el7_"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg></button><pre class="kroCodeBlock_J7AA"><code><span class="comment_cniX"># ConfigMap.data has PreserveUnknownFields</span>
<span class="yamlKey_lCMJ">configmap</span>:<!-- -->
<!-- -->  <span class="yamlKey_lCMJ">data</span>:<!-- -->
<!-- -->    <span class="comment_cniX"># kro cannot validate structure at build time</span>
<!-- -->    <span class="comment_cniX"># Any expression type is accepted</span>
<!-- -->    <span class="yamlKey_lCMJ">DATABASE_URL</span>: <span class="celExpression_MAYK">${schema.spec.dbUrl}</span>
<!-- -->    <span class="yamlKey_lCMJ">PORT</span>: <span class="celExpression_MAYK">${string(schema.spec.port)}</span></code></pre></div></div>
<p>kro still validates:</p>
<ul>
<li>Expression syntax is correct</li>
<li>Referenced resources exist</li>
<li>Types are internally consistent</li>
</ul>
<p>But it cannot validate:</p>
<ul>
<li>Field names are correct</li>
<li>Field types match (since schema is unknown)</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="next-steps">Next Steps<a href="#next-steps" class="hash-link" aria-label="Direct link to Next Steps" title="Direct link to Next Steps" translate="no">​</a></h2>
<ul>
<li><strong><a href="/kro/next/docs/concepts/rgd/resource-definitions/resource-basics">Resource Basics</a></strong> - See how templates are validated</li>
<li><strong><a href="/kro/next/docs/concepts/rgd/cel-expressions">CEL Expressions</a></strong> - Learn CEL type system</li>
<li><strong><a href="/kro/next/api/specifications/simple-schema">SimpleSchema</a></strong> - Define typed schemas</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/kubernetes-sigs/kro/tree/main/website/docs/docs/concepts/rgd/05-static-type-checking.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/kro/next/docs/concepts/rgd/dependencies-ordering"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Graph Inference</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/kro/next/docs/concepts/instances"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Instances</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-validation-process" class="table-of-contents__link toc-highlight">The Validation Process</a><ul><li><a href="#stage-1-schema-validation" class="table-of-contents__link toc-highlight">Stage 1: Schema Validation</a></li><li><a href="#stage-2-status-schema-inference" class="table-of-contents__link toc-highlight">Stage 2: Status Schema Inference</a></li><li><a href="#stage-3-resource-naming-validation" class="table-of-contents__link toc-highlight">Stage 3: Resource Naming Validation</a></li><li><a href="#stage-4-resource-template-validation" class="table-of-contents__link toc-highlight">Stage 4: Resource Template Validation</a></li><li><a href="#stage-5-ast-analysis-and-dependency-graph-building" class="table-of-contents__link toc-highlight">Stage 5: AST Analysis and Dependency Graph Building</a></li><li><a href="#stage-6-expression-type-checking" class="table-of-contents__link toc-highlight">Stage 6: Expression Type Checking</a></li><li><a href="#stage-7-condition-expression-validation" class="table-of-contents__link toc-highlight">Stage 7: Condition Expression Validation</a></li><li><a href="#stage-8-rgd-activation" class="table-of-contents__link toc-highlight">Stage 8: RGD Activation</a></li></ul></li><li><a href="#cel-ast-parsing-and-dependency-detection" class="table-of-contents__link toc-highlight">CEL AST Parsing and Dependency Detection</a><ul><li><a href="#how-ast-parsing-works" class="table-of-contents__link toc-highlight">How AST Parsing Works</a></li><li><a href="#dependency-graph-construction" class="table-of-contents__link toc-highlight">Dependency Graph Construction</a></li><li><a href="#reference-validation" class="table-of-contents__link toc-highlight">Reference Validation</a></li><li><a href="#circular-dependency-detection" class="table-of-contents__link toc-highlight">Circular Dependency Detection</a></li></ul></li><li><a href="#type-compatibility-deep-dive" class="table-of-contents__link toc-highlight">Type Compatibility Deep Dive</a><ul><li><a href="#structural-compatibility" class="table-of-contents__link toc-highlight">Structural Compatibility</a></li><li><a href="#mapstruct-compatibility" class="table-of-contents__link toc-highlight">Map/Struct Compatibility</a></li><li><a href="#nested-field-type-checking" class="table-of-contents__link toc-highlight">Nested Field Type Checking</a></li><li><a href="#preserveunknownfields-handling" class="table-of-contents__link toc-highlight">PreserveUnknownFields Handling</a></li></ul></li><li><a href="#next-steps" class="table-of-contents__link toc-highlight">Next Steps</a></li></ul></div></div></div></div></main></div></div></div><section class="kroFooter_cB_W"><p class="kroFooterText_sBXB">Brought to you with ♥ by<!-- --> <a href="https://github.com/kubernetes/community/tree/master/sig-cloud-provider" target="_blank" rel="noopener noreferrer">SIG Cloud Provider</a></p></section><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/kro/docs/overview">Tutorial</a></li><li class="footer__item"><a class="footer__link-item" href="/kro/examples/">Examples</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://kubernetes.slack.com/archives/C081TMY9D6Y" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/kubernetes-sigs/kro/blob/main/CONTRIBUTING.md" target="_blank" rel="noopener noreferrer" class="footer__link-item">Contribution Guide<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/kubernetes-sigs/kro" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCUlcI3NYq9ehl5wsdfbJzSA" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">kro is a subproject of Kubernetes SIG Cloud Provider. Kubernetes is a CNCF graduated project.</div></div></div></footer><script defer="" src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;85e669833a874cdd938772c6e459b33e&quot;}"></script></div>
</body>
</html>