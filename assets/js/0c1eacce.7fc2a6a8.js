"use strict";(self.webpackChunkkro_docs=self.webpackChunkkro_docs||[]).push([[8158],{14558:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>t,toc:()=>u});const t=JSON.parse('{"id":"docs/advanced/rgd-chaining","title":"RGD Chaining","description":"RGD chaining allows you to compose complex applications by building on top of existing ResourceGraphDefinitions. Instead of duplicating resource definitions, you can create instances of one RGD within another RGD\'s resource graph.","source":"@site/docs/docs/advanced/02-rgd-chaining.md","sourceDirName":"docs/advanced","slug":"/docs/advanced/rgd-chaining","permalink":"/kro/next/docs/advanced/rgd-chaining","draft":false,"unlisted":false,"editUrl":"https://github.com/kubernetes-sigs/kro/tree/main/website/docs/docs/advanced/02-rgd-chaining.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Access Control","permalink":"/kro/next/docs/advanced/access-control"},"next":{"title":"Controller Tuning","permalink":"/kro/next/docs/advanced/controller-tuning"}}');var s=a(74848),r=a(28453),i=a(11470),o=a(19365);const c={sidebar_position:2},l="RGD Chaining",d={},u=[{value:"How It Works",id:"how-it-works",level:2},{value:"Building Blocks",id:"building-blocks",level:2},{value:"Dependency Resolution",id:"dependency-resolution",level:2},{value:"Considerations",id:"considerations",level:2},{value:"Ordering",id:"ordering",level:3},{value:"Deletion",id:"deletion",level:3},{value:"Debugging",id:"debugging",level:3},{value:"Best Practices",id:"best-practices",level:2}];function p(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"rgd-chaining",children:"RGD Chaining"})}),"\n",(0,s.jsx)(n.p,{children:"RGD chaining allows you to compose complex applications by building on top of existing ResourceGraphDefinitions. Instead of duplicating resource definitions, you can create instances of one RGD within another RGD's resource graph."}),"\n",(0,s.jsx)(n.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,s.jsx)(n.p,{children:"When you create an RGD, kro registers a new Custom Resource Definition (CRD) in your cluster. This CRD can then be used as a resource in other RGDs, just like any other Kubernetes resource."}),"\n","\n",(0,s.jsxs)(i.A,{children:[(0,s.jsxs)(o.A,{value:"fullstack",label:"FullStackApp (Parent)",default:!0,children:[(0,s.jsx)(n.p,{children:"The parent RGD uses instances of other RGDs as resources:"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'apiVersion: kro.run/v1alpha1\nkind: ResourceGraphDefinition\nmetadata:\n  name: full-stack-app\nspec:\n  schema:\n    apiVersion: kro.run/v1alpha1\n    kind: FullStackApp\n    spec:\n      name: string\n      dbSize: string | default="small"\n    status:\n      databaseReady: ${database.status.ready}\n      appEndpoint: ${webapp.status.endpoint}\n\n  resources:\n    # Use an instance of the Database RGD\n    - id: database\n      template:\n        apiVersion: kro.run/v1alpha1\n        kind: Database\n        metadata:\n          name: ${schema.spec.name}-db\n        spec:\n          size: ${schema.spec.dbSize}\n      readyWhen:\n        - ${database.status.ready == true}\n\n    # Use an instance of the WebApplication RGD\n    - id: webapp\n      template:\n        apiVersion: kro.run/v1alpha1\n        kind: WebApplication\n        metadata:\n          name: ${schema.spec.name}-web\n        spec:\n          name: ${schema.spec.name}\n          image: myapp:latest\n          databaseUrl: ${database.status.connectionString}\n'})})]}),(0,s.jsxs)(o.A,{value:"database",label:"Database RGD",children:[(0,s.jsx)(n.p,{children:"The Database RGD creates a StatefulSet and exposes connection info:"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'apiVersion: kro.run/v1alpha1\nkind: ResourceGraphDefinition\nmetadata:\n  name: database\nspec:\n  schema:\n    apiVersion: kro.run/v1alpha1\n    kind: Database\n    spec:\n      size: string | default="small"\n    status:\n      ready: ${statefulset.status.readyReplicas == 1}\n      connectionString: "postgresql://postgres@${service.metadata.name}:5432/postgres"\n\n  resources:\n    - id: secret\n      template:\n        apiVersion: v1\n        kind: Secret\n        metadata:\n          name: ${schema.metadata.name}-credentials\n        stringData:\n          password: changeme\n\n    - id: statefulset\n      template:\n        apiVersion: apps/v1\n        kind: StatefulSet\n        metadata:\n          name: ${schema.metadata.name}\n        spec:\n          serviceName: ${schema.metadata.name}\n          replicas: 1\n          selector:\n            matchLabels:\n              app: ${schema.metadata.name}\n          template:\n            metadata:\n              labels:\n                app: ${schema.metadata.name}\n            spec:\n              containers:\n                - name: postgres\n                  image: postgres:15\n                  env:\n                    - name: POSTGRES_PASSWORD\n                      valueFrom:\n                        secretKeyRef:\n                          name: ${secret.metadata.name}\n                          key: password\n      readyWhen:\n        - ${statefulset.status.readyReplicas == 1}\n\n    - id: service\n      template:\n        apiVersion: v1\n        kind: Service\n        metadata:\n          name: ${schema.metadata.name}\n        spec:\n          selector:\n            app: ${schema.metadata.name}\n          ports:\n            - port: 5432\n'})})]}),(0,s.jsxs)(o.A,{value:"webapp",label:"WebApplication RGD",children:[(0,s.jsx)(n.p,{children:"The WebApplication RGD creates a Deployment, Service, and Ingress:"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'apiVersion: kro.run/v1alpha1\nkind: ResourceGraphDefinition\nmetadata:\n  name: web-application\nspec:\n  schema:\n    apiVersion: kro.run/v1alpha1\n    kind: WebApplication\n    spec:\n      name: string\n      image: string\n      databaseUrl: string | default=""\n    status:\n      ready: ${deployment.status.availableReplicas == 2}\n      endpoint: "https://${schema.spec.name}.example.com"\n\n  resources:\n    - id: deployment\n      template:\n        apiVersion: apps/v1\n        kind: Deployment\n        metadata:\n          name: ${schema.spec.name}\n        spec:\n          replicas: 2\n          selector:\n            matchLabels:\n              app: ${schema.spec.name}\n          template:\n            metadata:\n              labels:\n                app: ${schema.spec.name}\n            spec:\n              containers:\n                - name: app\n                  image: ${schema.spec.image}\n                  env:\n                    - name: DATABASE_URL\n                      value: ${schema.spec.databaseUrl}\n                  ports:\n                    - containerPort: 8080\n      readyWhen:\n        - ${deployment.status.availableReplicas == 2}\n\n    - id: service\n      template:\n        apiVersion: v1\n        kind: Service\n        metadata:\n          name: ${schema.spec.name}\n        spec:\n          selector:\n            app: ${schema.spec.name}\n          ports:\n            - port: 80\n              targetPort: 8080\n\n    - id: ingress\n      template:\n        apiVersion: networking.k8s.io/v1\n        kind: Ingress\n        metadata:\n          name: ${schema.spec.name}\n        spec:\n          rules:\n            - host: ${schema.spec.name}.example.com\n              http:\n                paths:\n                  - path: /\n                    pathType: Prefix\n                    backend:\n                      service:\n                        name: ${service.metadata.name}\n                        port:\n                          number: 80\n'})})]})]}),"\n",(0,s.jsx)(n.h2,{id:"building-blocks",children:"Building Blocks"}),"\n",(0,s.jsx)(n.p,{children:"RGD chaining enables a building blocks approach to platform engineering. Instead of creating monolithic RGDs that define everything, you can decompose your platform into small, focused RGDs that each do one thing well."}),"\n",(0,s.jsx)(n.p,{children:"Lower-level RGDs expose their capabilities through status fields - connection strings, endpoints, credentials, ready states. Higher-level RGDs consume these outputs as inputs, wiring components together without needing to understand their internals."}),"\n",(0,s.jsx)(n.p,{children:"This model lets platform teams build progressively higher abstractions. Application developers interact with simple, high-level APIs while the underlying complexity is managed by the RGD hierarchy."}),"\n",(0,s.jsx)(n.h2,{id:"dependency-resolution",children:"Dependency Resolution"}),"\n",(0,s.jsx)(n.p,{children:"When chaining RGDs, kro automatically:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Tracks dependencies"})," - Expressions like ",(0,s.jsx)(n.code,{children:"${database.status.connectionString}"})," create dependencies between the outer RGD and the inner instance"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Waits for readiness"})," - The outer RGD waits for the inner instance's ",(0,s.jsx)(n.code,{children:"Ready"})," condition before proceeding"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Propagates status"})," - You can expose inner instance status fields in the outer RGD's status"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"considerations",children:"Considerations"}),"\n",(0,s.jsx)(n.h3,{id:"ordering",children:"Ordering"}),"\n",(0,s.jsx)(n.p,{children:"RGD instances are created in topological order based on CEL expression dependencies, just like any other resource. The inner instance must be ready before dependent resources can reference its status."}),"\n",(0,s.jsx)(n.h3,{id:"deletion",children:"Deletion"}),"\n",(0,s.jsx)(n.p,{children:"When deleting an instance of a chained RGD:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"The outer instance is deleted first"}),"\n",(0,s.jsx)(n.li,{children:"This triggers deletion of its managed resources, including inner RGD instances"}),"\n",(0,s.jsx)(n.li,{children:"Inner instances then delete their own managed resources"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"debugging",children:"Debugging"}),"\n",(0,s.jsx)(n.p,{children:"Debugging chained RGDs requires checking multiple levels:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Check the outer instance's conditions"}),"\n",(0,s.jsxs)(n.li,{children:["If ",(0,s.jsx)(n.code,{children:"ResourcesReady"})," is false, identify which inner instance failed"]}),"\n",(0,s.jsx)(n.li,{children:"Check the inner instance's conditions for the root cause"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Check outer instance\nkubectl get fullstackapp my-app -o yaml\n\n# Check inner instances\nkubectl get database my-app-db -o yaml\nkubectl get webapplication my-app-web -o yaml\n"})}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Keep RGDs small and focused"})," - Create RGDs with clear inputs (spec) and outputs (status) that make them easy to chain."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Expose necessary status"})," - Inner RGDs should expose status fields that outer RGDs need (connection strings, endpoints, etc.)."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Use meaningful names"})," - Name inner instances based on the outer instance's name to maintain traceability."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Consider depth"})," - Deep chaining (RGDs within RGDs within RGDs) can make debugging harder. Keep nesting reasonable."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}},19365:(e,n,a)=>{a.d(n,{A:()=>i});a(96540);var t=a(34164);const s={tabItem:"tabItem_Ymn6"};var r=a(74848);function i({children:e,hidden:n,className:a}){return(0,r.jsx)("div",{role:"tabpanel",className:(0,t.A)(s.tabItem,a),hidden:n,children:e})}},11470:(e,n,a)=>{a.d(n,{A:()=>D});var t=a(96540),s=a(34164),r=a(17559),i=a(23104),o=a(56347),c=a(205),l=a(57485),d=a(31682),u=a(70679);function p(e){return t.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:n,children:a}=e;return(0,t.useMemo)((()=>{const e=n??function(e){return p(e).map((({props:{value:e,label:n,attributes:a,default:t}})=>({value:e,label:n,attributes:a,default:t})))}(a);return function(e){const n=(0,d.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,a])}function m({value:e,tabValues:n}){return n.some((n=>n.value===e))}function g({queryString:e=!1,groupId:n}){const a=(0,o.W6)(),s=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,l.aZ)(s),(0,t.useCallback)((e=>{if(!s)return;const n=new URLSearchParams(a.location.search);n.set(s,e),a.replace({...a.location,search:n.toString()})}),[s,a])]}function b(e){const{defaultValue:n,queryString:a=!1,groupId:s}=e,r=h(e),[i,o]=(0,t.useState)((()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!m({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:n,tabValues:r}))),[l,d]=g({queryString:a,groupId:s}),[p,b]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[a,s]=(0,u.Dv)(n);return[a,(0,t.useCallback)((e=>{n&&s.set(e)}),[n,s])]}({groupId:s}),f=(()=>{const e=l??p;return m({value:e,tabValues:r})?e:null})();(0,c.A)((()=>{f&&o(f)}),[f]);return{selectedValue:i,selectValue:(0,t.useCallback)((e=>{if(!m({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);o(e),d(e),b(e)}),[d,b,r]),tabValues:r}}var f=a(92303);const v={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var x=a(74848);function y({className:e,block:n,selectedValue:a,selectValue:t,tabValues:r}){const o=[],{blockElementScrollPositionUntilNextRender:c}=(0,i.a_)(),l=e=>{const n=e.currentTarget,s=o.indexOf(n),i=r[s].value;i!==a&&(c(n),t(i))},d=e=>{let n=null;switch(e.key){case"Enter":l(e);break;case"ArrowRight":{const a=o.indexOf(e.currentTarget)+1;n=o[a]??o[0];break}case"ArrowLeft":{const a=o.indexOf(e.currentTarget)-1;n=o[a]??o[o.length-1];break}}n?.focus()};return(0,x.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":n},e),children:r.map((({value:e,label:n,attributes:t})=>(0,x.jsx)("li",{role:"tab",tabIndex:a===e?0:-1,"aria-selected":a===e,ref:e=>{o.push(e)},onKeyDown:d,onClick:l,...t,className:(0,s.A)("tabs__item",v.tabItem,t?.className,{"tabs__item--active":a===e}),children:n??e},e)))})}function k({lazy:e,children:n,selectedValue:a}){const r=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=r.find((e=>e.props.value===a));return e?(0,t.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,x.jsx)("div",{className:"margin-top--md",children:r.map(((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==a})))})}function j(e){const n=b(e);return(0,x.jsxs)("div",{className:(0,s.A)(r.G.tabs.container,"tabs-container",v.tabList),children:[(0,x.jsx)(y,{...n,...e}),(0,x.jsx)(k,{...n,...e})]})}function D(e){const n=(0,f.A)();return(0,x.jsx)(j,{...e,children:p(e.children)},String(n))}},28453:(e,n,a)=>{a.d(n,{R:()=>i,x:()=>o});var t=a(96540);const s={},r=t.createContext(s);function i(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);