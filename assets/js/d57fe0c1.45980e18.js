"use strict";(self.webpackChunkkro_docs=self.webpackChunkkro_docs||[]).push([[3046],{73679:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"docs/concepts/access-control","title":"Access Control","description":"There are currently two modes of access control supported by kro, if you","source":"@site/versioned_docs/version-0.6.3/docs/concepts/20-access-control.md","sourceDirName":"docs/concepts","slug":"/docs/concepts/access-control","permalink":"/kro/0.6.3/docs/concepts/access-control","draft":false,"unlisted":false,"editUrl":"https://github.com/kubernetes-sigs/kro/tree/main/website/versioned_docs/version-0.6.3/docs/concepts/20-access-control.md","tags":[],"version":"0.6.3","sidebarPosition":20,"frontMatter":{"sidebar_position":20},"sidebar":"docsSidebar","previous":{"title":"Instances","permalink":"/kro/0.6.3/docs/concepts/instances"},"next":{"title":"FAQ","permalink":"/kro/0.6.3/docs/faq"}}');var o=n(74848),c=n(28453);const t={sidebar_position:20},i="Access Control",l={},a=[{value:"<code>unrestricted</code> Access",id:"unrestricted-access",level:2},{value:"<code>aggregation</code> Access",id:"aggregation-access",level:2},{value:"Example",id:"example",level:3}];function d(e){const s={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.header,{children:(0,o.jsx)(s.h1,{id:"access-control",children:"Access Control"})}),"\n",(0,o.jsxs)(s.p,{children:["There are currently two modes of access control supported by ",(0,o.jsx)(s.strong,{children:"kro"}),", if you\n",(0,o.jsx)(s.a,{href:"/kro/0.6.3/docs/getting-started/Installation#install-kro-using-helm",children:"install through the Helm chart"}),":"]}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsx)(s.p,{children:(0,o.jsx)(s.code,{children:"unrestricted"})}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsx)(s.p,{children:(0,o.jsx)(s.code,{children:"aggregation"})}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(s.p,{children:["The mode is selected with a ",(0,o.jsx)(s.code,{children:"values"})," property ",(0,o.jsx)(s.code,{children:"rbac.mode"}),", and defaults to ",(0,o.jsx)(s.code,{children:"unrestricted"}),"."]}),"\n",(0,o.jsxs)(s.h2,{id:"unrestricted-access",children:[(0,o.jsx)(s.code,{children:"unrestricted"})," Access"]}),"\n",(0,o.jsxs)(s.p,{children:["In the ",(0,o.jsx)(s.code,{children:"unrestricted"})," access mode, the chart includes a ",(0,o.jsx)(s.code,{children:"ClusterRole"})," granting\n",(0,o.jsx)(s.strong,{children:"kro"})," ",(0,o.jsx)(s.em,{children:"full control to every resource type in your cluster"}),". This can be\nuseful for experimenting in a test environment, where access control is not\nnecessary, but is not recommended in a production environment."]}),"\n",(0,o.jsxs)(s.p,{children:["In this mode, anyone with access to create ",(0,o.jsx)(s.code,{children:"ResourceGraphDefinition"})," resources,\neffectively also has admin access to the cluster."]}),"\n",(0,o.jsxs)(s.h2,{id:"aggregation-access",children:[(0,o.jsx)(s.code,{children:"aggregation"})," Access"]}),"\n",(0,o.jsxs)(s.p,{children:["In the ",(0,o.jsx)(s.code,{children:"aggregation"})," access mode, the chart includes an ",(0,o.jsxs)(s.a,{href:"https://kubernetes.io/docs/reference/access-authn-authz/rbac/#aggregated-clusterroles",children:[(0,o.jsx)(s.em,{children:"aggregated"})," ",(0,o.jsx)(s.code,{children:"ClusterRole"})]}),"\nwhich dynamically includes all rules from all ",(0,o.jsx)(s.code,{children:"ClusterRoles"})," that have the label\n",(0,o.jsx)(s.code,{children:'rbac.kro.run/aggregate-to-controller: "true"'}),"."]}),"\n",(0,o.jsxs)(s.p,{children:["There is a very minimal set of permissions provisioned by the chart itself, just\nenough to let ",(0,o.jsx)(s.strong,{children:"kro"})," run at all: full permissions for ",(0,o.jsx)(s.code,{children:"ResourceGraphDefinition"}),"s\nand its subresources, and full permissions for ",(0,o.jsx)(s.code,{children:"CustomResourceDefinitions"})," as\n",(0,o.jsx)(s.strong,{children:"kro"})," will create them in response to the existence of an RGD."]}),"\n",(0,o.jsxs)(s.p,{children:["However, this does ",(0,o.jsx)(s.em,{children:"not"})," automatically set up permissions for ",(0,o.jsx)(s.strong,{children:"kro"})," to actually\nreconcile those generated CRDs! In other words, when using this mode, you will\nneed to provision additional access for ",(0,o.jsx)(s.strong,{children:"kro"})," for every new resource type you\ndefine."]}),"\n",(0,o.jsx)(s.h3,{id:"example",children:"Example"}),"\n",(0,o.jsxs)(s.p,{children:["If you want to create a ",(0,o.jsx)(s.code,{children:"ResourceGraphDefinition"})," that specifies a new resource\ntype with ",(0,o.jsx)(s.code,{children:"kind: Foo"}),", and where the graph includes an ",(0,o.jsx)(s.code,{children:"apps/v1/Deployment"})," and\na ",(0,o.jsx)(s.code,{children:"v1/ConfigMap"}),", you will need to create the following ",(0,o.jsx)(s.code,{children:"ClusterRole"})," to ensure\n",(0,o.jsx)(s.strong,{children:"kro"})," has enough access to reconcile your resources:"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-yaml",children:'apiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  labels:\n    rbac.kro.run/aggregate-to-controller: "true"\n  name: kro:controller:foos\nrules:\n  - apiGroups:\n      - kro.run\n    resources:\n      - foos\n    verbs:\n      - "*"\n  - apiGroups:\n      - apps\n    resources:\n      - deployments\n    verbs:\n      - "*"\n  - apiGroups:\n      - ""\n    resources:\n      - configmaps\n    verbs:\n      - "*"\n'})})]})}function h(e={}){const{wrapper:s}={...(0,c.R)(),...e.components};return s?(0,o.jsx)(s,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>t,x:()=>i});var r=n(96540);const o={},c=r.createContext(o);function t(e){const s=r.useContext(c);return r.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),r.createElement(c.Provider,{value:s},e.children)}}}]);