"use strict";(self.webpackChunkkro_docs=self.webpackChunkkro_docs||[]).push([[8320],{36840:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"docs/concepts/rgd/resource-definitions/readiness","title":"Readiness","description":"Not all resources are ready immediately after creation. A Deployment might exist but have zero available replicas, or a LoadBalancer Service might not have an external IP yet. If dependent resources try to use values that don\'t exist yet, they\'ll fail or get invalid data.","source":"@site/docs/docs/concepts/rgd/02-resource-definitions/03-readiness.md","sourceDirName":"docs/concepts/rgd/02-resource-definitions","slug":"/docs/concepts/rgd/resource-definitions/readiness","permalink":"/kro/next/docs/concepts/rgd/resource-definitions/readiness","draft":false,"unlisted":false,"editUrl":"https://github.com/kubernetes-sigs/kro/tree/main/website/docs/docs/concepts/rgd/02-resource-definitions/03-readiness.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Conditionals","permalink":"/kro/next/docs/concepts/rgd/resource-definitions/conditional-creation"},"next":{"title":"Collections","permalink":"/kro/next/docs/concepts/rgd/resource-definitions/collections"}}');var t=s(74848),i=s(28453);const a={sidebar_position:3},o="Readiness",d={},c=[{value:"Basic Example",id:"basic-example",level:2},{value:"How readyWhen Works",id:"how-readywhen-works",level:2},{value:"What You Can Reference",id:"what-you-can-reference",level:2},{value:"Dependencies and Readiness",id:"dependencies-and-readiness",level:2},{value:"The Optional Operator (?)",id:"the-optional-operator-",level:2},{value:"Next Steps",id:"next-steps",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"readiness",children:"Readiness"})}),"\n",(0,t.jsx)(n.p,{children:"Not all resources are ready immediately after creation. A Deployment might exist but have zero available replicas, or a LoadBalancer Service might not have an external IP yet. If dependent resources try to use values that don't exist yet, they'll fail or get invalid data."}),"\n",(0,t.jsxs)(n.p,{children:["kro provides the ",(0,t.jsx)(n.code,{children:"readyWhen"})," field to define when a resource is considered ready. When you add ",(0,t.jsx)(n.code,{children:"readyWhen"})," to a resource, kro waits for all conditions to be true before proceeding with dependent resources."]}),"\n",(0,t.jsx)(n.h2,{id:"basic-example",children:"Basic Example"}),"\n",(0,t.jsx)(n.p,{children:"Here's a simple example where a database must be fully ready before the application deployment is created:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-kro",children:'resources:\n  - id: database\n    template:\n      apiVersion: database.example.com/v1\n      kind: PostgreSQL\n      metadata:\n        name: ${schema.spec.name}-db\n      spec:\n        version: "15"\n    readyWhen:\n      - ${database.status.conditions.exists(c, c.type == "Ready" && c.status == "True")}\n      - ${database.status.?endpoint != ""}\n\n  - id: app\n    template:\n      apiVersion: apps/v1\n      kind: Deployment\n      metadata:\n        name: ${schema.spec.name}\n      spec:\n        template:\n          spec:\n            containers:\n              - name: app\n                image: ${schema.spec.image}\n                env:\n                  - name: DATABASE_HOST\n                    value: ${database.status.endpoint}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"app"})," deployment won't be created until:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["The database resource exists ",(0,t.jsx)(n.strong,{children:"AND"})]}),"\n",(0,t.jsxs)(n.li,{children:["The database has a Ready condition with status True ",(0,t.jsx)(n.strong,{children:"AND"})]}),"\n",(0,t.jsx)(n.li,{children:"The database has an endpoint in its status"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["This ensures ",(0,t.jsx)(n.code,{children:"${database.status.endpoint}"})," has a valid value when the app is created."]}),"\n",(0,t.jsx)(n.h2,{id:"how-readywhen-works",children:"How readyWhen Works"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"readyWhen"})," is a list of CEL expressions that control when a resource is considered ready:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsxs)(n.strong,{children:["Without ",(0,t.jsx)(n.code,{children:"readyWhen"})]}),": Resources are ready once created and all their CEL expression references resolve"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsxs)(n.strong,{children:["With ",(0,t.jsx)(n.code,{children:"readyWhen"})]}),": Resources are created but remain in a waiting state until all conditions are true"]}),"\n",(0,t.jsxs)(n.li,{children:["If ",(0,t.jsx)(n.strong,{children:"all"})," expressions evaluate to ",(0,t.jsx)(n.code,{children:"true"}),", the resource is marked ready"]}),"\n",(0,t.jsxs)(n.li,{children:["If ",(0,t.jsx)(n.strong,{children:"any"})," expression evaluates to ",(0,t.jsx)(n.code,{children:"false"}),", the resource continues waiting"]}),"\n",(0,t.jsxs)(n.li,{children:["Each expression must evaluate to a ",(0,t.jsx)(n.strong,{children:"boolean"})," value (",(0,t.jsx)(n.code,{children:"true"})," or ",(0,t.jsx)(n.code,{children:"false"}),")"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Dependent resources wait"})," until all their dependencies are ready"]}),"\n",(0,t.jsxs)(n.li,{children:["For ",(0,t.jsx)(n.a,{href:"/kro/next/docs/concepts/rgd/resource-definitions/collections",children:"collections"}),", ",(0,t.jsx)(n.code,{children:"readyWhen"})," applies to the entire collection"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"what-you-can-reference",children:"What You Can Reference"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"readyWhen"})," expressions can only reference the resource itself (by its ",(0,t.jsx)(n.code,{children:"id"}),").\nFor collections, use the ",(0,t.jsx)(n.code,{children:"each"})," keyword to reference the current item:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-kro",children:'# \u2713 Valid - references the resource itself and returns boolean\n- id: deployment\n  readyWhen:\n    - ${deployment.status.availableReplicas > 0}\n    - ${deployment.status.conditions.exists(c, c.type == "Available" && c.status == "True")}\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-kro",children:"# \u2713 Valid for collections - uses each for per-item readiness\n- id: workerPods\n  forEach:\n    - worker: ${schema.spec.workers}\n  readyWhen:\n    - ${each.status.phase == 'Running'}\n  template:\n    kind: Pod\n    metadata:\n      name: ${schema.metadata.name + '-' + worker}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-kro",children:"# \u2717 Invalid - cannot reference other resources or schema\n- id: deployment\n  readyWhen:\n    - ${service.status.loadBalancer.ingress.size() > 0}  # Can't reference other resources\n    - ${schema.spec.replicas > 3}  # Can't reference schema\n    - ${deployment.status.availableReplicas}  # Must return boolean\n"})}),"\n",(0,t.jsxs)(n.p,{children:["kro validates ",(0,t.jsx)(n.code,{children:"readyWhen"})," expressions when you create the ResourceGraphDefinition, ensuring they reference valid fields and return boolean values."]}),"\n",(0,t.jsx)(n.admonition,{type:"important",children:(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"readyWhen"})," determines when ",(0,t.jsx)(n.strong,{children:"this specific resource"})," is ready. It can't depend on other resources' states - that's handled automatically by the dependency graph when you reference other resources in your templates. This keeps readiness conditions local, deterministic, and easy to debug."]})}),"\n",(0,t.jsx)(n.h2,{id:"dependencies-and-readiness",children:"Dependencies and Readiness"}),"\n",(0,t.jsxs)(n.p,{children:["When a resource has a ",(0,t.jsx)(n.code,{children:"readyWhen"})," condition, ",(0,t.jsx)(n.strong,{children:"all resources that depend on it must wait"})," until it's ready."]}),"\n",(0,t.jsx)(n.p,{children:"kro processes resources in the correct order based on references. If a resource references another resource's status field, kro:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Creates the referenced resource first"}),"\n",(0,t.jsxs)(n.li,{children:["Waits for its ",(0,t.jsx)(n.code,{children:"readyWhen"})," conditions (if any) to be satisfied"]}),"\n",(0,t.jsx)(n.li,{children:"Only then creates the dependent resource with the correct status values"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"This ensures your resources always have valid data and prevents race conditions."}),"\n",(0,t.jsx)(n.h2,{id:"the-optional-operator-",children:"The Optional Operator (?)"}),"\n",(0,t.jsxs)(n.p,{children:["Use the optional operator ",(0,t.jsx)(n.code,{children:"?"})," when accessing fields that are truly optional or have unknown structure:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-kro",children:'readyWhen:\n  # Use ? for optional fields that might never exist\n  - ${service.status.?loadBalancer.?ingress.size() > 0}\n\n  # Use ? for fields with unknown structure (like ConfigMap data)\n  - ${config.data.?endpoint != ""}\n\n  # No ? needed for fields that will eventually exist\n  - ${database.status.endpoint != ""}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"?"})," operator returns ",(0,t.jsx)(n.code,{children:"null"})," if the field doesn't exist. This is useful when a field is optional or its structure is unknown at validation time. For fields that will eventually exist, kro simply waits for them to become available."]}),"\n",(0,t.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"/kro/next/docs/concepts/rgd/dependencies-ordering",children:"Dependencies & Ordering"})})," - Understand how kro determines resource creation order"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"/kro/next/docs/concepts/rgd/resource-definitions/conditional-creation",children:"Conditional Resources"})})," - Control whether resources are created"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"/kro/next/docs/concepts/rgd/resource-definitions/collections",children:"Collections"})})," - Use aggregate readiness conditions with ",(0,t.jsx)(n.code,{children:"forEach"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"/kro/next/docs/concepts/rgd/cel-expressions",children:"CEL Expressions"})})," - Master expression syntax for readiness conditions"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>o});var r=s(96540);const t={},i=r.createContext(t);function a(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);