"use strict";(self.webpackChunkkro_docs=self.webpackChunkkro_docs||[]).push([[3723],{83595:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>m,frontMatter:()=>r,metadata:()=>a,toc:()=>p});const a=JSON.parse('{"id":"examples/basic/web-app-ingress","title":"Web Application w/ Ingress","description":"","source":"@site/versioned_docs/version-0.6.1/examples/basic/web-app-ingress.md","sourceDirName":"examples/basic","slug":"/examples/basic/web-app-ingress","permalink":"/kro/0.6.1/examples/basic/web-app-ingress","draft":false,"unlisted":false,"editUrl":"https://github.com/kubernetes-sigs/kro/tree/main/website/versioned_docs/version-0.6.1/examples/basic/web-app-ingress.md","tags":[],"version":"0.6.1","sidebarPosition":102,"frontMatter":{"sidebar_position":102},"sidebar":"examplesSidebar","previous":{"title":"Empty ResourceGraphDefinition","permalink":"/kro/0.6.1/examples/basic/noop"},"next":{"title":"Web Application","permalink":"/kro/0.6.1/examples/basic/web-app"}}');var t=s(74848),i=s(28453);const r={sidebar_position:102},o="Web Application w/ Ingress",c={},p=[];function l(e){const n={code:"code",h1:"h1",header:"header",pre:"pre",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"web-application-w-ingress",children:"Web Application w/ Ingress"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="webapp-ingress.yaml"',children:'apiVersion: kro.run/v1alpha1\nkind: ResourceGraphDefinition\nmetadata:\n  name: my-application\nspec:\n  # kro uses this simple schema to create your CRD schema and apply it\n  # The schema defines what users can provide when they instantiate the RGD (create an instance).\n  schema:\n    apiVersion: v1alpha1\n    kind: Application\n    spec:\n      # Spec fields that users can provide.\n      name: string\n      image: string | default="nginx"\n      ingress:\n        enabled: boolean | default=false\n    status:\n      # Fields the controller will inject into instances status.\n      deploymentConditions: ${deployment.status.conditions}\n      availableReplicas: ${deployment.status.availableReplicas}\n\n  # Define the resources this API will manage.\n  resources:\n    - id: deployment\n      template:\n        apiVersion: apps/v1\n        kind: Deployment\n        metadata:\n          name: ${schema.spec.name} # Use the name provided by user\n        spec:\n          replicas: 3\n          selector:\n            matchLabels:\n              app: ${schema.spec.name}\n          template:\n            metadata:\n              labels:\n                app: ${schema.spec.name}\n            spec:\n              containers:\n                - name: ${schema.spec.name}\n                  image: ${schema.spec.image} # Use the image provided by user\n                  ports:\n                    - containerPort: 80\n\n    - id: service\n      template:\n        apiVersion: v1\n        kind: Service\n        metadata:\n          name: ${schema.spec.name}-service\n        spec:\n          selector: ${deployment.spec.selector.matchLabels} # Use the deployment selector\n          ports:\n            - protocol: TCP\n              port: 80\n              targetPort: 80\n\n    - id: ingress\n      includeWhen:\n        - ${schema.spec.ingress.enabled} # Only include if the user wants to create an Ingress\n      template:\n        apiVersion: networking.k8s.io/v1\n        kind: Ingress\n        metadata:\n          name: ${schema.spec.name}-ingress\n          annotations:\n            kubernetes.io/ingress.class: alb\n            alb.ingress.kubernetes.io/scheme: internet-facing\n            alb.ingress.kubernetes.io/target-type: ip\n            alb.ingress.kubernetes.io/healthcheck-path: /health\n            alb.ingress.kubernetes.io/listen-ports: \'[{"HTTP": 80}]\'\n            alb.ingress.kubernetes.io/target-group-attributes: stickiness.enabled=true,stickiness.lb_cookie.duration_seconds=60\n        spec:\n          rules:\n            - http:\n                paths:\n                  - path: "/"\n                    pathType: Prefix\n                    backend:\n                      service:\n                        name: ${service.metadata.name} # Use the service name\n                        port:\n                          number: 80\n'})})]})}function m(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>o});var a=s(96540);const t={},i=a.createContext(t);function r(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);