"use strict";(self.webpackChunkkro_docs=self.webpackChunkkro_docs||[]).push([[1713],{10097:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"docs/concepts/rgd/cel-expressions","title":"CEL Expressions","description":"CEL (Common Expression Language) is the language you use in kro to reference data between resources, compute values, and define conditions. Understanding CEL is essential for creating ResourceGraphDefinitions.","source":"@site/docs/docs/concepts/rgd/03-cel-expressions.md","sourceDirName":"docs/concepts/rgd","slug":"/docs/concepts/rgd/cel-expressions","permalink":"/next/docs/concepts/rgd/cel-expressions","draft":false,"unlisted":false,"editUrl":"https://github.com/kubernetes-sigs/kro/tree/main/website/docs/docs/concepts/rgd/03-cel-expressions.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"External References","permalink":"/next/docs/concepts/rgd/resource-definitions/external-references"},"next":{"title":"Graph Inference","permalink":"/next/docs/concepts/rgd/dependencies-ordering"}}');var r=s(74848),t=s(28453);const a={sidebar_position:2},l="CEL Expressions",c={},o=[{value:"What is CEL?",id:"what-is-cel",level:2},{value:"Why CEL is Safe",id:"why-cel-is-safe",level:3},{value:"Why CEL is Fast",id:"why-cel-is-fast",level:3},{value:"CEL&#39;s Design Principles",id:"cels-design-principles",level:3},{value:"CEL Syntax in kro",id:"cel-syntax-in-kro",level:2},{value:"Expression Delimiters",id:"expression-delimiters",level:3},{value:"Two Types of Expressions",id:"two-types-of-expressions",level:3},{value:"1. Standalone Expressions",id:"1-standalone-expressions",level:4},{value:"2. String Templates",id:"2-string-templates",level:4},{value:"Referencing Data",id:"referencing-data",level:2},{value:"The <code>schema</code> Variable",id:"the-schema-variable",level:3},{value:"Resource Variables",id:"resource-variables",level:3},{value:"Field Paths",id:"field-paths",level:3},{value:"Array Indexing",id:"array-indexing",level:3},{value:"The Optional Operator (<code>?</code>)",id:"the-optional-operator-",level:2},{value:"When to Use <code>?</code>",id:"when-to-use-",level:3},{value:"Syntax",id:"syntax",level:3},{value:"Examples",id:"examples",level:3},{value:"Available CEL Libraries",id:"available-cel-libraries",level:2},{value:"Type Checking and Validation",id:"type-checking-and-validation",level:2},{value:"How Type Checking Works",id:"how-type-checking-works",level:3},{value:"Type Compatibility",id:"type-compatibility",level:3},{value:"1. Exact Type Match",id:"1-exact-type-match",level:4},{value:"2. Structural Compatibility (Duck Typing)",id:"2-structural-compatibility-duck-typing",level:4},{value:"Working with Dynamic Types",id:"working-with-dynamic-types",level:3},{value:"Common Patterns",id:"common-patterns",level:2},{value:"Conditional Values",id:"conditional-values",level:3},{value:"Building Complex Objects",id:"building-complex-objects",level:3},{value:"String Formatting",id:"string-formatting",level:3},{value:"Working with Lists",id:"working-with-lists",level:3},{value:"Aggregating Status",id:"aggregating-status",level:3},{value:"Troubleshooting CEL Errors",id:"troubleshooting-cel-errors",level:2},{value:"Common Errors",id:"common-errors",level:3},{value:"&quot;undeclared reference to &#39;X&#39;&quot;",id:"undeclared-reference-to-x",level:4},{value:"&quot;expected type &#39;X&#39; but found &#39;Y&#39;&quot;",id:"expected-type-x-but-found-y",level:4},{value:"&quot;no such key: X&quot;",id:"no-such-key-x",level:4},{value:"&quot;index out of bounds&quot;",id:"index-out-of-bounds",level:4},{value:"Debugging Tips",id:"debugging-tips",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"cel-expressions",children:"CEL Expressions"})}),"\n",(0,r.jsx)(n.p,{children:"CEL (Common Expression Language) is the language you use in kro to reference data between resources, compute values, and define conditions. Understanding CEL is essential for creating ResourceGraphDefinitions."}),"\n",(0,r.jsx)(n.h2,{id:"what-is-cel",children:"What is CEL?"}),"\n",(0,r.jsx)(n.p,{children:"CEL (Common Expression Language) is an open-source expression language originally created by Google. It's the same language Kubernetes uses for validation rules, admission control, and field selectors."}),"\n",(0,r.jsx)(n.h3,{id:"why-cel-is-safe",children:"Why CEL is Safe"}),"\n",(0,r.jsxs)(n.p,{children:["CEL was designed specifically to be safe for executing user code. Unlike scripting languages where you'd never blindly execute user-provided code, ",(0,r.jsx)(n.strong,{children:"you can safely execute user-written CEL expressions"}),". This safety comes from:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"No side effects"}),": CEL expressions can't modify state, write files, or make network calls"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Guaranteed termination"}),": No loops or recursion means expressions always complete"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Resource bounded"}),": Expressions are prevented from consuming excessive memory or CPU"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Sandboxed execution"}),": CEL can't access the filesystem or system resources"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"why-cel-is-fast",children:"Why CEL is Fast"}),"\n",(0,r.jsxs)(n.p,{children:["CEL is optimized for ",(0,r.jsx)(n.strong,{children:"compile-once, evaluate-many"})," workflows:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Parse and check"})," expressions once at configuration time (when you create an RGD)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Store"})," the checked AST (Abstract Syntax Tree)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Evaluate"})," the stored AST repeatedly at runtime against different inputs"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Because CEL prevents behaviors that would make it slower, expressions evaluate in ",(0,r.jsx)(n.strong,{children:"nanoseconds to microseconds"}),"\u2014making it ideal for performance-critical reconciliation loops."]}),"\n",(0,r.jsx)(n.h3,{id:"cels-design-principles",children:"CEL's Design Principles"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Safe"}),": Designed for executing untrusted user code"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Fast"}),": Evaluates in microseconds"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Type-safe"}),": Types are checked before execution"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Simple"}),": Easy-to-read syntax similar to JavaScript/Go"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Portable"}),": Platform-independent expression language"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"kro uses CEL throughout ResourceGraphDefinitions to make them dynamic and interconnected while maintaining safety and performance."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Learn more:"})," ",(0,r.jsx)(n.a,{href:"https://cel.dev",children:"CEL Overview"})," | ",(0,r.jsx)(n.a,{href:"https://github.com/google/cel-spec",children:"CEL Language Specification"})," | ",(0,r.jsx)(n.a,{href:"https://pkg.go.dev/github.com/google/cel-go",children:"CEL Go Documentation"})]}),"\n",(0,r.jsx)(n.h2,{id:"cel-syntax-in-kro",children:"CEL Syntax in kro"}),"\n",(0,r.jsx)(n.h3,{id:"expression-delimiters",children:"Expression Delimiters"}),"\n",(0,r.jsxs)(n.p,{children:["In kro, CEL expressions are wrapped in ",(0,r.jsx)(n.code,{children:"${"})," and ",(0,r.jsx)(n.code,{children:"}"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"metadata:\n  name: ${schema.spec.appName}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Everything between ",(0,r.jsx)(n.code,{children:"${"})," and ",(0,r.jsx)(n.code,{children:"}"})," is a CEL expression that gets evaluated at runtime."]}),"\n",(0,r.jsx)(n.h3,{id:"two-types-of-expressions",children:"Two Types of Expressions"}),"\n",(0,r.jsx)(n.h4,{id:"1-standalone-expressions",children:"1. Standalone Expressions"}),"\n",(0,r.jsxs)(n.p,{children:["A ",(0,r.jsx)(n.strong,{children:"standalone expression"})," is a field whose value is exactly one expression - nothing else:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec:\n  replicas: ${schema.spec.replicaCount}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The expression result ",(0,r.jsx)(n.strong,{children:"replaces the entire field value"}),". The result type must match the field's expected type:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"If the field expects an integer, the expression must return an integer"}),"\n",(0,r.jsx)(n.li,{children:"If the field expects an object, the expression must return an object"}),"\n",(0,r.jsx)(n.li,{children:"etc."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Examples:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"# Integer field\nreplicas: ${schema.spec.count}\n\n# String field\nimage: ${schema.spec.containerImage}\n\n# Boolean field\nenabled: ${schema.spec.featureEnabled}\n\n# Object field\nenv: ${configmap.data}\n\n# Array field\nvolumes: ${schema.spec.volumeMounts}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"2-string-templates",children:"2. String Templates"}),"\n",(0,r.jsxs)(n.p,{children:["A ",(0,r.jsx)(n.strong,{children:"string template"})," contains one or more expressions embedded in a string:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'metadata:\n  name: "${schema.spec.prefix}-${schema.spec.name}"\n'})}),"\n",(0,r.jsxs)(n.p,{children:["All expressions in a string template ",(0,r.jsx)(n.strong,{children:"must return strings"}),", and the result is always a string (concatenation of all parts)."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Examples:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'# Simple concatenation\nname: "app-${schema.spec.name}"\n\n# Multiple expressions\nconnectionString: "host=${database.status.endpoint}:${database.status.port}"\n\n# With literal text\nmessage: "Application ${schema.spec.name} is running version ${schema.spec.version}"\n'})}),"\n",(0,r.jsxs)(n.admonition,{type:"warning",children:[(0,r.jsxs)(n.p,{children:["Expressions in string templates ",(0,r.jsx)(n.strong,{children:"must return strings"}),". This won't work:"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'name: "app-${schema.spec.replicas}"  # Error: replicas is an integer\n'})}),(0,r.jsxs)(n.p,{children:["Use ",(0,r.jsx)(n.code,{children:".string()"})," or ",(0,r.jsx)(n.code,{children:"format()"})," to convert:"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'name: "app-${schema.spec.replicas.string()}"\n'})})]}),"\n",(0,r.jsx)(n.h2,{id:"referencing-data",children:"Referencing Data"}),"\n",(0,r.jsxs)(n.h3,{id:"the-schema-variable",children:["The ",(0,r.jsx)(n.code,{children:"schema"})," Variable"]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"schema"})," variable represents the ",(0,r.jsx)(n.strong,{children:"instance spec"})," - the values users provide when creating an instance of your API."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Instance:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"apiVersion: kro.run/v1alpha1\nkind: WebApplication\nmetadata:\n  name: my-app\nspec:\n  appName: awesome-app\n  replicas: 3\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["In your RGD, access via ",(0,r.jsx)(n.code,{children:"schema.spec"}),":"]})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'resources:\n  - id: deployment\n    template:\n      metadata:\n        name: ${schema.spec.appName}      # "awesome-app"\n      spec:\n        replicas: ${schema.spec.replicas}  # 3\n'})}),"\n",(0,r.jsx)(n.h3,{id:"resource-variables",children:"Resource Variables"}),"\n",(0,r.jsxs)(n.p,{children:["Each resource in your RGD can be referenced by its ",(0,r.jsx)(n.code,{children:"id"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"resources:\n  - id: deployment\n    template:\n      apiVersion: apps/v1\n      kind: Deployment\n      # ... deployment spec\n\n  - id: service\n    template:\n      apiVersion: v1\n      kind: Service\n      spec:\n        selector:\n          # Reference the deployment's labels\n          app: ${deployment.spec.template.metadata.labels.app}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["This ",(0,r.jsx)(n.strong,{children:"automatically creates a dependency"}),": the service depends on the deployment. kro will create the deployment first. See ",(0,r.jsx)(n.a,{href:"/next/docs/concepts/rgd/dependencies-ordering",children:"Dependencies & Ordering"})," for details."]}),"\n",(0,r.jsx)(n.h3,{id:"field-paths",children:"Field Paths"}),"\n",(0,r.jsx)(n.p,{children:"Use dot notation to navigate nested fields:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"# Access nested objects\n${deployment.spec.template.spec.containers[0].image}\n\n# Access map values\n${configmap.data.DATABASE_URL}\n\n# Access status fields\n${deployment.status.availableReplicas}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"array-indexing",children:"Array Indexing"}),"\n",(0,r.jsxs)(n.p,{children:["Access array elements using ",(0,r.jsx)(n.code,{children:"[index]"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"# First container's image\n${deployment.spec.template.spec.containers[0].image}\n\n# Second port\n${service.spec.ports[1].port}\n"})}),"\n",(0,r.jsxs)(n.h2,{id:"the-optional-operator-",children:["The Optional Operator (",(0,r.jsx)(n.code,{children:"?"}),")"]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"?"})," operator makes a field access optional. If the field doesn't exist, the expression returns ",(0,r.jsx)(n.code,{children:"null"})," instead of failing."]}),"\n",(0,r.jsxs)(n.h3,{id:"when-to-use-",children:["When to Use ",(0,r.jsx)(n.code,{children:"?"})]}),"\n",(0,r.jsx)(n.p,{children:"Use the optional operator when:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Referencing schema-less objects"})," (ConfigMaps, Secrets without known structure)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Accessing fields that might not exist"})," (optional status fields)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Working with dynamic data"})," where structure isn't guaranteed"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"syntax",children:"Syntax"}),"\n",(0,r.jsxs)(n.p,{children:["Place ",(0,r.jsx)(n.code,{children:"?"})," before the field that might not exist:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"${configmap.data.?DATABASE_URL}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["If ",(0,r.jsx)(n.code,{children:"data.DATABASE_URL"})," doesn't exist, this returns ",(0,r.jsx)(n.code,{children:"null"})," instead of erroring."]}),"\n",(0,r.jsx)(n.h3,{id:"examples",children:"Examples"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Referencing a ConfigMap:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"resources:\n  - id: config\n    externalRef:\n      apiVersion: v1\n      kind: ConfigMap\n      metadata:\n        name: app-config\n\n  - id: deployment\n    template:\n      spec:\n        containers:\n          - env:\n              - name: DATABASE_URL\n                # ConfigMap might not have this key\n                value: ${config.data.?DATABASE_URL}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Optional status fields:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"# Some resources might not have this status field immediately\nready: ${deployment.status.?readyReplicas > 0}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Chaining optional accessors:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"# Multiple fields might not exist\n${service.status.?loadBalancer.?ingress[0].?hostname}\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"?"})," operator prevents kro from validating the field's existence at build time. Use it sparingly - prefer explicit schemas when possible."]})}),"\n",(0,r.jsx)(n.h2,{id:"available-cel-libraries",children:"Available CEL Libraries"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Library"}),(0,r.jsx)(n.th,{children:"Documentation"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Lists"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://pkg.go.dev/github.com/google/cel-go/ext#Lists",children:"cel-go/ext"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Strings"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://pkg.go.dev/github.com/google/cel-go/ext#Strings",children:"cel-go/ext"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Encoders"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://pkg.go.dev/github.com/google/cel-go/ext#Encoders",children:"cel-go/ext"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Random"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://github.com/kubernetes-sigs/kro/blob/main/pkg/cel/library/random.go",children:"kro custom"})})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:["For the complete CEL language reference, see the ",(0,r.jsx)(n.a,{href:"https://github.com/google/cel-spec/blob/master/doc/langdef.md#list-of-standard-definitions",children:"CEL language definitions"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"type-checking-and-validation",children:"Type Checking and Validation"}),"\n",(0,r.jsxs)(n.p,{children:["One of kro's key features is ",(0,r.jsx)(n.strong,{children:"compile-time type checking"})," of CEL expressions."]}),"\n",(0,r.jsx)(n.h3,{id:"how-type-checking-works",children:"How Type Checking Works"}),"\n",(0,r.jsx)(n.p,{children:"When you create an RGD, kro:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Fetches the OpenAPI schema for each resource type from the API server"}),"\n",(0,r.jsx)(n.li,{children:"Validates that every field path in your expressions exists"}),"\n",(0,r.jsx)(n.li,{children:"Checks that expression output types match target field types"}),"\n",(0,r.jsxs)(n.li,{children:["Reports errors ",(0,r.jsx)(n.strong,{children:"before"})," any instances are created"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec:\n  replicas: ${schema.spec.appName}  # Error: appName is string, replicas expects integer\n"})}),"\n",(0,r.jsx)(n.p,{children:"kro will reject this RGD with a clear error message."}),"\n",(0,r.jsx)(n.h3,{id:"type-compatibility",children:"Type Compatibility"}),"\n",(0,r.jsx)(n.p,{children:"kro checks two forms of compatibility:"}),"\n",(0,r.jsx)(n.h4,{id:"1-exact-type-match",children:"1. Exact Type Match"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"# \u2713 Correct: integer to integer\nreplicas: ${schema.spec.replicaCount}\n\n# \u2717 Wrong: string to integer\nreplicas: ${schema.spec.appName}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"2-structural-compatibility-duck-typing",children:"2. Structural Compatibility (Duck Typing)"}),"\n",(0,r.jsx)(n.p,{children:"kro supports structural compatibility for complex types through deep type inspection:"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Map \u2194 Struct compatibility"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"# Map can be assigned to struct\n# Map keys must be strings matching struct field names\n# Map values must be compatible with corresponding field types\nlabels: ${schema.spec.labelMap}\n\n# Struct can be assigned to map\n# Struct field names become string keys\n# Struct field types must be compatible with map value type\nannotations: ${deployment.metadata.labels}\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Struct subset semantics"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"# Output struct can have FEWER fields than expected (subset)\n# But cannot have EXTRA fields that expected doesn't have\n# Each field that exists must have compatible type\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"List and Map recursive checking"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Lists: Element types must be structurally compatible"}),"\n",(0,r.jsx)(n.li,{children:"Maps: Both key and value types must be structurally compatible"}),"\n",(0,r.jsx)(n.li,{children:"Recursively validated for nested structures"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"working-with-dynamic-types",children:"Working with Dynamic Types"}),"\n",(0,r.jsxs)(n.p,{children:["For resources with ",(0,r.jsx)(n.code,{children:"x-kubernetes-preserve-unknown-fields: true"})," (like ConfigMap data), kro can't validate structure. Use the ",(0,r.jsx)(n.code,{children:"?"})," operator:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"# kro can't validate ConfigMap.data structure\nvalue: ${configmap.data.?myKey}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"common-patterns",children:"Common Patterns"}),"\n",(0,r.jsx)(n.h3,{id:"conditional-values",children:"Conditional Values"}),"\n",(0,r.jsx)(n.p,{children:"Use ternary operator for conditional values:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'# If-then-else\nimage: ${schema.spec.env == "prod" ? "nginx:stable" : "nginx:latest"}\n\n# With optional\nreplicas: ${schema.spec.?replicas.orValue(3)}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"building-complex-objects",children:"Building Complex Objects"}),"\n",(0,r.jsx)(n.p,{children:"Create objects inline:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"env:\n  - name: DATABASE_URL\n    value: ${database.status.endpoint}\n  - name: DATABASE_PORT\n    value: ${database.status.port.string()}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Or use CEL to construct them:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'labels: ${{"app": schema.spec.name, "env": schema.spec.environment}}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"string-formatting",children:"String Formatting"}),"\n",(0,r.jsx)(n.p,{children:"Build connection strings and URLs:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'# Connection string\nconnectionString: "postgresql://${db.status.endpoint}:${db.status.port}/${schema.spec.dbName}"\n\n# ARN format\nroleArn: "arn:aws:iam::%s:role/%s".format([schema.spec.accountId, schema.spec.roleName])\n'})}),"\n",(0,r.jsx)(n.h3,{id:"working-with-lists",children:"Working with Lists"}),"\n",(0,r.jsx)(n.p,{children:"Filter, map, and transform lists:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'# Extract specific fields\ncontainerNames: ${deployment.spec.template.spec.containers.map(c, c.name)}\n\n# Filter by condition\nreadyConditions: ${deployment.status.conditions.filter(c, c.status == "True")}\n\n# Check all items\nallReady: ${schema.spec.services.all(s, s.enabled)}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"aggregating-status",children:"Aggregating Status"}),"\n",(0,r.jsx)(n.p,{children:"Collect status from multiple resources:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"status:\n  # From single resource\n  endpoint: ${service.status.loadBalancer.ingress[0].hostname}\n\n  # Computed from multiple\n  allReady: ${deployment.status.availableReplicas == schema.spec.replicas && service.status.loadBalancer.ingress.size() > 0}\n\n  # Complex aggregation\n  totalPods: ${deployment.status.replicas + statefulset.status.replicas}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting-cel-errors",children:"Troubleshooting CEL Errors"}),"\n",(0,r.jsx)(n.h3,{id:"common-errors",children:"Common Errors"}),"\n",(0,r.jsx)(n.h4,{id:"undeclared-reference-to-x",children:"\"undeclared reference to 'X'\""}),"\n",(0,r.jsx)(n.p,{children:"The resource or field doesn't exist in the dependency graph."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Fix:"})," Check the resource ",(0,r.jsx)(n.code,{children:"id"})," or field path is correct."]}),"\n",(0,r.jsx)(n.h4,{id:"expected-type-x-but-found-y",children:"\"expected type 'X' but found 'Y'\""}),"\n",(0,r.jsx)(n.p,{children:"Expression output type doesn't match the target field type."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Fix:"})," Convert the type or fix the expression:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"# Wrong\nreplicas: ${schema.spec.count}  # count is string\n\n# Right\nreplicas: ${schema.spec.count.int()}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"no-such-key-x",children:'"no such key: X"'}),"\n",(0,r.jsx)(n.p,{children:"Accessing a map key that doesn't exist."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Fix:"})," Use the optional operator:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'value: ${configmap.data.?KEY.orValue("default")}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"index-out-of-bounds",children:'"index out of bounds"'}),"\n",(0,r.jsx)(n.p,{children:"Accessing an array index that doesn't exist."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Fix:"})," Check array size first:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'value: ${list.size() > 0 ? list[0] : "default"}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"debugging-tips",children:"Debugging Tips"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Start simple"}),": Test expressions with literal values first"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Check schemas"}),": Use ",(0,r.jsx)(n.code,{children:"kubectl explain"})," to verify field paths exist"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Use ",(0,r.jsx)(n.code,{children:"?"})," judiciously"]}),": Start without it, add only when needed"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Read error messages"}),": kro's type checker provides detailed error messages"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Test incrementally"}),": Add one expression at a time"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"/next/docs/concepts/rgd/dependencies-ordering",children:"Dependencies & Ordering"})})," - Learn how CEL expressions create dependencies"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"/next/docs/concepts/rgd/resource-definitions/conditional-creation",children:"Conditional Creation"})})," - Use CEL for ",(0,r.jsx)(n.code,{children:"includeWhen"})," conditions"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"/next/docs/concepts/rgd/resource-definitions/readiness",children:"Readiness"})})," - Use CEL for ",(0,r.jsx)(n.code,{children:"readyWhen"})," conditions"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"/next/docs/concepts/rgd/resource-definitions/external-references",children:"External References"})})," - Reference external resources with CEL"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>l});var i=s(96540);const r={},t=i.createContext(r);function a(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);