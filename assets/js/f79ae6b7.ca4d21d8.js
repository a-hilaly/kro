"use strict";(self.webpackChunkkro_docs=self.webpackChunkkro_docs||[]).push([[1076],{83856:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>i,default:()=>a,frontMatter:()=>c,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"docs/advanced/metrics","title":"Controller Metrics","description":"kro exposes Prometheus metrics for monitoring controller health and performance. These metrics are available at the metrics endpoint (default :8078/metrics), configurable via Helm values.","source":"@site/docs/docs/advanced/04-metrics.md","sourceDirName":"docs/advanced","slug":"/docs/advanced/metrics","permalink":"/kro/next/docs/advanced/metrics","draft":false,"unlisted":false,"editUrl":"https://github.com/kubernetes-sigs/kro/tree/main/website/docs/docs/advanced/04-metrics.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"docsSidebar","previous":{"title":"Controller Tuning","permalink":"/kro/next/docs/advanced/controller-tuning"},"next":{"title":"FAQ","permalink":"/kro/next/docs/faq"}}');var d=n(74848),s=n(28453);const c={sidebar_position:4},i="Controller Metrics",l={},o=[{value:"Enabling Metrics",id:"enabling-metrics",level:2},{value:"Dynamic Controller Metrics",id:"dynamic-controller-metrics",level:2},{value:"Schema Resolver Metrics",id:"schema-resolver-metrics",level:2},{value:"Controller Runtime Metrics",id:"controller-runtime-metrics",level:2},{value:"Workqueue Metrics",id:"workqueue-metrics",level:2}];function h(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(r.header,{children:(0,d.jsx)(r.h1,{id:"controller-metrics",children:"Controller Metrics"})}),"\n",(0,d.jsxs)(r.p,{children:["kro exposes Prometheus metrics for monitoring controller health and performance. These metrics are available at the metrics endpoint (default ",(0,d.jsx)(r.code,{children:":8078/metrics"}),"), configurable via Helm values."]}),"\n",(0,d.jsx)(r.h2,{id:"enabling-metrics",children:"Enabling Metrics"}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-yaml",children:"metrics:\n  service:\n    create: true\n    port: 8080\n  serviceMonitor:\n    enabled: true  # If using Prometheus Operator\n    interval: 1m\n"})}),"\n",(0,d.jsx)(r.h2,{id:"dynamic-controller-metrics",children:"Dynamic Controller Metrics"}),"\n",(0,d.jsxs)(r.table,{children:[(0,d.jsx)(r.thead,{children:(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.th,{children:"Metric"}),(0,d.jsx)(r.th,{children:"Type"}),(0,d.jsx)(r.th,{children:"Description"}),(0,d.jsx)(r.th,{children:"Stability"})]})}),(0,d.jsxs)(r.tbody,{children:[(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"dynamic_controller_reconcile_total"})}),(0,d.jsx)(r.td,{children:"Counter"}),(0,d.jsx)(r.td,{children:"Total number of reconciliations per GVR"}),(0,d.jsx)(r.td,{children:"ALPHA"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"dynamic_controller_reconcile_duration_seconds"})}),(0,d.jsx)(r.td,{children:"Histogram"}),(0,d.jsx)(r.td,{children:"Duration of reconciliations per GVR in seconds"}),(0,d.jsx)(r.td,{children:"ALPHA"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"dynamic_controller_requeue_total"})}),(0,d.jsx)(r.td,{children:"Counter"}),(0,d.jsx)(r.td,{children:"Total number of requeues per GVR and requeue type"}),(0,d.jsx)(r.td,{children:"ALPHA"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"dynamic_controller_handler_errors_total"})}),(0,d.jsx)(r.td,{children:"Counter"}),(0,d.jsx)(r.td,{children:"Total number of handler errors per GVR"}),(0,d.jsx)(r.td,{children:"ALPHA"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"dynamic_controller_queue_length"})}),(0,d.jsx)(r.td,{children:"Gauge"}),(0,d.jsx)(r.td,{children:"Current length of the workqueue"}),(0,d.jsx)(r.td,{children:"ALPHA"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"dynamic_controller_gvr_count"})}),(0,d.jsx)(r.td,{children:"Gauge"}),(0,d.jsx)(r.td,{children:"Number of instance GVRs currently managed by the controller"}),(0,d.jsx)(r.td,{children:"ALPHA"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"dynamic_controller_handler_count_total"})}),(0,d.jsx)(r.td,{children:"Gauge"}),(0,d.jsx)(r.td,{children:"Number of active handlers by type (parent or child)"}),(0,d.jsx)(r.td,{children:"ALPHA"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"dynamic_controller_handler_attach_total"})}),(0,d.jsx)(r.td,{children:"Counter"}),(0,d.jsx)(r.td,{children:"Total number of handler attachments by type"}),(0,d.jsx)(r.td,{children:"ALPHA"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"dynamic_controller_handler_detach_total"})}),(0,d.jsx)(r.td,{children:"Counter"}),(0,d.jsx)(r.td,{children:"Total number of handler detachments by type"}),(0,d.jsx)(r.td,{children:"ALPHA"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"dynamic_controller_informer_events_total"})}),(0,d.jsx)(r.td,{children:"Counter"}),(0,d.jsx)(r.td,{children:"Total number of events processed by informers per GVR and event type"}),(0,d.jsx)(r.td,{children:"ALPHA"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"dynamic_controller_informer_sync_duration_seconds"})}),(0,d.jsx)(r.td,{children:"Histogram"}),(0,d.jsx)(r.td,{children:"Duration of informer cache sync per GVR in seconds"}),(0,d.jsx)(r.td,{children:"ALPHA"})]})]})]}),"\n",(0,d.jsx)(r.h2,{id:"schema-resolver-metrics",children:"Schema Resolver Metrics"}),"\n",(0,d.jsxs)(r.table,{children:[(0,d.jsx)(r.thead,{children:(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.th,{children:"Metric"}),(0,d.jsx)(r.th,{children:"Type"}),(0,d.jsx)(r.th,{children:"Description"}),(0,d.jsx)(r.th,{children:"Stability"})]})}),(0,d.jsxs)(r.tbody,{children:[(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"schema_resolver_cache_hits_total"})}),(0,d.jsx)(r.td,{children:"Counter"}),(0,d.jsx)(r.td,{children:"Total number of schema resolver cache hits"}),(0,d.jsx)(r.td,{children:"ALPHA"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"schema_resolver_cache_misses_total"})}),(0,d.jsx)(r.td,{children:"Counter"}),(0,d.jsx)(r.td,{children:"Total number of schema resolver cache misses"}),(0,d.jsx)(r.td,{children:"ALPHA"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"schema_resolver_cache_size"})}),(0,d.jsx)(r.td,{children:"Gauge"}),(0,d.jsx)(r.td,{children:"Current number of entries in the schema resolver cache"}),(0,d.jsx)(r.td,{children:"ALPHA"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"schema_resolver_cache_evictions_total"})}),(0,d.jsx)(r.td,{children:"Counter"}),(0,d.jsx)(r.td,{children:"Total number of entries evicted from the schema resolver cache"}),(0,d.jsx)(r.td,{children:"ALPHA"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"schema_resolver_api_call_duration_seconds"})}),(0,d.jsx)(r.td,{children:"Histogram"}),(0,d.jsx)(r.td,{children:"Duration of API calls to fetch schemas in seconds"}),(0,d.jsx)(r.td,{children:"ALPHA"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"schema_resolver_singleflight_deduplicated_total"})}),(0,d.jsx)(r.td,{children:"Counter"}),(0,d.jsx)(r.td,{children:"Total number of requests deduplicated by singleflight"}),(0,d.jsx)(r.td,{children:"ALPHA"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"schema_resolver_errors_total"})}),(0,d.jsx)(r.td,{children:"Counter"}),(0,d.jsx)(r.td,{children:"Total number of schema resolution errors"}),(0,d.jsx)(r.td,{children:"ALPHA"})]})]})]}),"\n",(0,d.jsx)(r.h2,{id:"controller-runtime-metrics",children:"Controller Runtime Metrics"}),"\n",(0,d.jsxs)(r.p,{children:["The RGD reconciler uses controller-runtime and exposes its ",(0,d.jsx)(r.a,{href:"https://book.kubebuilder.io/reference/metrics.html",children:"standard metrics"}),":"]}),"\n",(0,d.jsxs)(r.table,{children:[(0,d.jsx)(r.thead,{children:(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.th,{children:"Metric"}),(0,d.jsx)(r.th,{children:"Type"}),(0,d.jsx)(r.th,{children:"Description"}),(0,d.jsx)(r.th,{children:"Stability"})]})}),(0,d.jsxs)(r.tbody,{children:[(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"controller_runtime_reconcile_total"})}),(0,d.jsx)(r.td,{children:"Counter"}),(0,d.jsx)(r.td,{children:"Total number of reconciliations per controller"}),(0,d.jsx)(r.td,{children:"STABLE"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"controller_runtime_reconcile_time_seconds"})}),(0,d.jsx)(r.td,{children:"Histogram"}),(0,d.jsx)(r.td,{children:"Length of time per reconciliation per controller"}),(0,d.jsx)(r.td,{children:"STABLE"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"controller_runtime_reconcile_errors_total"})}),(0,d.jsx)(r.td,{children:"Counter"}),(0,d.jsx)(r.td,{children:"Total number of reconciliation errors per controller"}),(0,d.jsx)(r.td,{children:"STABLE"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"controller_runtime_terminal_reconcile_errors_total"})}),(0,d.jsx)(r.td,{children:"Counter"}),(0,d.jsx)(r.td,{children:"Total number of terminal reconciliation errors per controller"}),(0,d.jsx)(r.td,{children:"STABLE"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"controller_runtime_reconcile_panics_total"})}),(0,d.jsx)(r.td,{children:"Counter"}),(0,d.jsx)(r.td,{children:"Total number of reconciliation panics per controller"}),(0,d.jsx)(r.td,{children:"STABLE"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"controller_runtime_max_concurrent_reconciles"})}),(0,d.jsx)(r.td,{children:"Gauge"}),(0,d.jsx)(r.td,{children:"Maximum number of concurrent reconciles per controller"}),(0,d.jsx)(r.td,{children:"STABLE"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"controller_runtime_active_workers"})}),(0,d.jsx)(r.td,{children:"Gauge"}),(0,d.jsx)(r.td,{children:"Number of currently used workers per controller"}),(0,d.jsx)(r.td,{children:"STABLE"})]})]})]}),"\n",(0,d.jsx)(r.h2,{id:"workqueue-metrics",children:"Workqueue Metrics"}),"\n",(0,d.jsxs)(r.table,{children:[(0,d.jsx)(r.thead,{children:(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.th,{children:"Metric"}),(0,d.jsx)(r.th,{children:"Type"}),(0,d.jsx)(r.th,{children:"Description"}),(0,d.jsx)(r.th,{children:"Stability"})]})}),(0,d.jsxs)(r.tbody,{children:[(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"workqueue_adds_total"})}),(0,d.jsx)(r.td,{children:"Counter"}),(0,d.jsx)(r.td,{children:"Total number of adds handled by workqueue"}),(0,d.jsx)(r.td,{children:"STABLE"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"workqueue_depth"})}),(0,d.jsx)(r.td,{children:"Gauge"}),(0,d.jsx)(r.td,{children:"Current depth of workqueue"}),(0,d.jsx)(r.td,{children:"STABLE"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"workqueue_queue_duration_seconds"})}),(0,d.jsx)(r.td,{children:"Histogram"}),(0,d.jsx)(r.td,{children:"How long in seconds an item stays in workqueue before being requested"}),(0,d.jsx)(r.td,{children:"STABLE"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"workqueue_work_duration_seconds"})}),(0,d.jsx)(r.td,{children:"Histogram"}),(0,d.jsx)(r.td,{children:"How long in seconds processing an item from workqueue takes"}),(0,d.jsx)(r.td,{children:"STABLE"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"workqueue_retries_total"})}),(0,d.jsx)(r.td,{children:"Counter"}),(0,d.jsx)(r.td,{children:"Total number of retries handled by workqueue"}),(0,d.jsx)(r.td,{children:"STABLE"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"workqueue_longest_running_processor_seconds"})}),(0,d.jsx)(r.td,{children:"Gauge"}),(0,d.jsx)(r.td,{children:"How many seconds has the longest running processor for workqueue been running"}),(0,d.jsx)(r.td,{children:"STABLE"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"workqueue_unfinished_work_seconds"})}),(0,d.jsx)(r.td,{children:"Gauge"}),(0,d.jsx)(r.td,{children:"How many seconds of work has been done that is in progress and hasn't been observed by work_duration"}),(0,d.jsx)(r.td,{children:"STABLE"})]})]})]})]})}function a(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,d.jsx)(r,{...e,children:(0,d.jsx)(h,{...e})}):h(e)}},28453:(e,r,n)=>{n.d(r,{R:()=>c,x:()=>i});var t=n(96540);const d={},s=t.createContext(d);function c(e){const r=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:c(e.components),t.createElement(s.Provider,{value:r},e.children)}}}]);