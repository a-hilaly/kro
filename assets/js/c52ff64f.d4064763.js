"use strict";(self.webpackChunkkro_docs=self.webpackChunkkro_docs||[]).push([[8337],{47790:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>d,frontMatter:()=>i,metadata:()=>a,toc:()=>o});const a=JSON.parse('{"id":"examples/kubernetes/saas-multi-tenant","title":"SaaS Multi-Tenant","description":"This example demonstrates how to create a multi-tenant SaaS application using Kro ResourceGraphDefinitions. It creates isolated tenant environments with dedicated applications, following a hierarchical structure of ResourceGraphDefinitions.","source":"@site/docs/examples/kubernetes/saas-multi-tenant.md","sourceDirName":"examples/kubernetes","slug":"/examples/kubernetes/saas-multi-tenant","permalink":"/kro/next/examples/kubernetes/saas-multi-tenant","draft":false,"unlisted":false,"editUrl":"https://github.com/kubernetes-sigs/kro/tree/main/website/docs/examples/kubernetes/saas-multi-tenant.md","tags":[],"version":"current","sidebarPosition":707,"frontMatter":{"sidebar_position":707},"sidebar":"examplesSidebar","previous":{"title":"CoreDNS Deployment","permalink":"/kro/next/examples/kubernetes/deploying-coredns"},"next":{"title":"job-example","permalink":"/kro/next/examples/kubernetes/job-example"}}');var s=t(74848),r=t(28453);const i={sidebar_position:707},l="SaaS Multi-Tenant",c={},o=[{value:"Overview",id:"overview",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Getting Started",id:"getting-started",level:2},{value:"Create ResourceGraphDefinition",id:"create-resourcegraphdefinition",level:3},{value:"Create Tenant Instance",id:"create-tenant-instance",level:3},{value:"Clean Up",id:"clean-up",level:2}];function p(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components},{Details:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"saas-multi-tenant",children:"SaaS Multi-Tenant"})}),"\n",(0,s.jsx)(n.p,{children:"This example demonstrates how to create a multi-tenant SaaS application using Kro ResourceGraphDefinitions. It creates isolated tenant environments with dedicated applications, following a hierarchical structure of ResourceGraphDefinitions."}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"This example creates a multi-tenant architecture with:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"TenantEnvironment"}),": Creates isolated namespaces with resource quotas and NetworkPolicy"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"TenantApplication"}),": Deploys applications within tenant environments"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Tenant"}),": Orchestrates tenant environments and applications together"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The example uses a hierarchical approach where each ResourceGraphDefinition builds upon standard Kubernetes resources."}),"\n",(0,s.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,s.jsx)(n.mermaid,{value:'graph TB\n    subgraph "Kubernetes Cluster"\n        subgraph "tenant-a namespace"\n            TA_D[Deployment]\n            TA_S[Service]\n            TA_RQ[ResourceQuota]\n            TA_NP[NetworkPolicy]\n            TA_NS[Namespace]\n        end\n\n        subgraph "tenant-b namespace"\n            TB_D[Deployment]\n            TB_S[Service]\n            TB_RQ[ResourceQuota]\n            TB_NP[NetworkPolicy]\n            TB_NS[Namespace]\n        end\n\n        subgraph "Kro ResourceGraphDefinitions"\n            RGD1[TenantEnvironment RGD]\n            RGD2[TenantApplication RGD]\n            RGD3[Tenant RGD]\n        end\n    end\n    RGD1 --\x3e TA_NS\n    RGD1 --\x3e TB_NS\n    RGD1 --\x3e TA_RQ\n    RGD1 --\x3e TB_RQ\n    RGD1 --\x3e TA_NP\n    RGD1 --\x3e TB_NP\n\n    RGD2 --\x3e TA_D\n    RGD2 --\x3e TA_S\n    RGD2 --\x3e TB_D\n    RGD2 --\x3e TB_S\n    RGD3 --\x3e RGD1\n    RGD3 --\x3e RGD2\n\n    style RGD1 fill:#e1f5fe\n    style RGD2 fill:#f3e5f5\n    style RGD3 fill:#e8f5e8'}),"\n",(0,s.jsx)(n.h2,{id:"getting-started",children:"Getting Started"}),"\n",(0,s.jsx)(n.p,{children:"Apply the ResourceGraphDefinitions and instance in the following order:"}),"\n",(0,s.jsx)(n.h3,{id:"create-resourcegraphdefinition",children:"Create ResourceGraphDefinition"}),"\n",(0,s.jsx)(n.p,{children:"Apply the tenant environment RGD:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f tenant-environment-rgd.yaml\n"})}),"\n",(0,s.jsx)(n.p,{children:"Apply the tenant application RGD:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f tenant-application-rgd.yaml\n"})}),"\n",(0,s.jsx)(n.p,{children:"Apply the main tenant RGD:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f tenant-rgd.yaml\n"})}),"\n",(0,s.jsx)(n.p,{children:"Check all RGDs are in Active state:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl get rgd\n"})}),"\n",(0,s.jsx)(n.p,{children:"Expected result:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"NAME                               APIVERSION   KIND              STATE    AGE\ntenantenvironment.kro.run         v1alpha1     TenantEnvironment Active   2m\ntenantapplication.kro.run         v1alpha1     TenantApplication Active   1m\ntenant.kro.run                    v1alpha1     Tenant           Active   30s\n"})}),"\n",(0,s.jsx)(n.h3,{id:"create-tenant-instance",children:"Create Tenant Instance"}),"\n",(0,s.jsx)(n.p,{children:"Apply the tenant instance:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f tenant-instance.yaml\n"})}),"\n",(0,s.jsx)(n.p,{children:"Check tenant instance status:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl get tenant\n"})}),"\n",(0,s.jsx)(n.p,{children:"Expected result:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"NAME          STATE    SYNCED   AGE\ntenant001   ACTIVE   True     5m\n"})}),"\n",(0,s.jsx)(n.h2,{id:"clean-up",children:"Clean Up"}),"\n",(0,s.jsx)(n.p,{children:"Remove resources in reverse order:"}),"\n",(0,s.jsx)(n.p,{children:"Remove Tenant Instance:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl delete -f tenant-instance-tmpl.yaml\n"})}),"\n",(0,s.jsx)(n.p,{children:"Remove ResourceGraphDefinitions:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl delete -f tenant-rgd.yaml\nkubectl delete -f tenant-application-rgd.yaml\nkubectl delete -f tenant-environment-rgd.yaml\n"})}),"\n",(0,s.jsxs)(t,{children:[(0,s.jsx)("summary",{children:"ResourceGraphDefinition"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kro",metastring:'title="rgd.yaml"',children:'apiVersion: kro.run/v1alpha1\nkind: ResourceGraphDefinition\nmetadata:\nname: tenantenvironment.kro.run\nspec:\nschema:\n  apiVersion: v1alpha1\n  kind: TenantEnvironment\n  spec:\n    tenantId: string\nresources:\n- id: tenantNamespace\n  template:\n    apiVersion: v1\n    kind: Namespace\n    metadata:\n      name: ${schema.spec.tenantId}\n      labels:\n        name: ${schema.spec.tenantId}\n- id: tenantQuota\n  template:\n    apiVersion: v1\n    kind: ResourceQuota\n    metadata:\n      name: ${schema.spec.tenantId}-quota\n      namespace: ${schema.spec.tenantId}\n      labels:\n        saas/tenant-id: ${schema.spec.tenantId}\n    spec:\n      hard:\n        requests.cpu: "1"\n        requests.memory: "1Gi"\n        limits.cpu: "2"\n        limits.memory: "2Gi"\n- id: tenantNetworkpolicy\n  template:\n    apiVersion: networking.k8s.io/v1\n    kind: NetworkPolicy\n    metadata:\n      name: ${schema.spec.tenantId}-isolation\n      namespace: ${schema.spec.tenantId}\n      labels:\n        saas/tenant-id: ${schema.spec.tenantId}\n    spec:\n      podSelector:\n        matchLabels:\n      ingress:\n      - from:\n        - podSelector: {}\n'})})]})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>l});var a=t(96540);const s={},r=a.createContext(s);function i(e){const n=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);