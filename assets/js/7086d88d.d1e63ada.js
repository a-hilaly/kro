"use strict";(self.webpackChunkkro_docs=self.webpackChunkkro_docs||[]).push([[6928],{32043:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>i,contentTitle:()=>c,default:()=>m,frontMatter:()=>o,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"examples/kubernetes/deploying-coredns","title":"CoreDNS Deployment","description":"","source":"@site/versioned_docs/version-0.3.0/examples/kubernetes/deploying-coredns.md","sourceDirName":"examples/kubernetes","slug":"/examples/kubernetes/deploying-coredns","permalink":"/0.3.0/examples/kubernetes/deploying-coredns","draft":false,"unlisted":false,"editUrl":"https://github.com/kubernetes-sigs/kro/tree/main/website/versioned_docs/version-0.3.0/examples/kubernetes/deploying-coredns.md","tags":[],"version":"0.3.0","sidebarPosition":10,"frontMatter":{"sidebar_position":10},"sidebar":"examplesSidebar","previous":{"title":"GCSBucketWithFinalizerTrigger","permalink":"/0.3.0/examples/gcp/eventarc"}}');var t=s(74848),r=s(28453);const o={sidebar_position:10},c="CoreDNS Deployment",i={},l=[];function p(e){const n={code:"code",h1:"h1",header:"header",pre:"pre",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"coredns-deployment",children:"CoreDNS Deployment"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="coredns-rg.yaml"',children:'apiVersion: kro.run/v1alpha1\nkind: ResourceGraphDefinition\nmetadata:\n  name: coredns.kro.run\nspec:\n  schema:\n    apiVersion: v1alpha1\n    kind: CoreDNSDeployment\n    spec:\n      name: string | default=mycoredns\n      namespace: string | default=default\n      values:\n        clusterRole:\n          labels: \'map[string]string | default={"eks.amazonaws.com/component": "coredns", "k8s-app": "kube-dns", "kubernetes.io/bootstrapping": "rbac-defaults"}\'\n        clusterRoleBinding:\n          annotations: \'map[string]string | default={"rbac.authorization.kubernetes.io/autoupdate": "\\"true\\""}\'\n        configMap:\n          labels: \'map[string]string | default={"eks.amazonaws.com/component": "coredns", "k8s-app": "kube-dns"}\'\n        deployment:\n          annotations: \'map[string]string | default={"deployment.kubernetes.io/revision": "\\"1\\""}\'\n          labels: \'map[string]string | default={"eks.amazonaws.com/component": "coredns", "k8s-app": "kube-dns", "kubernetes.io/name": "CoreDNS"}\'\n          replicas: integer | default=2\n        image:\n          repository: string | default=coredns/coredns\n          tag: string | default=1.11.3\n        resources:\n          limits:\n            cpu: string | default=100m\n            memory: string | default=128Mi\n          requests:\n            cpu: string | default=100m\n            memory: string | default=128Mi\n        service:\n          annotations: \'map[string]string | default={"prometheus.io/port": "9153", "prometheus.io/scrape": "true"}\'\n          labels: \'map[string]string | default={"eks.amazonaws.com/component": "kube-dns", "k8s-app": "kube-dns", "kubernetes.io/cluster-service": "true", "kubernetes.io/name": "CoreDNS"}\'\n          clusterIP: string | default=10.100.123.45\n          clusterIPs: \'[]string | default=["10.100.123.45"]\'\n          ipFamilies: \'[]string | default=["IPv4"]\'\n          type: string | default=ClusterIP\n        serviceAccount:\n          secrets: \'map[string]string | default={"name": "coredns-token-pvcnf"}\'\n  resources:\n  - id: clusterRole\n    template:\n      apiVersion: rbac.authorization.k8s.io/v1\n      kind: ClusterRole\n      metadata:\n        name: ${schema.spec.name}\n        labels: ${schema.spec.values.clusterRole.labels}\n      rules:\n      - apiGroups:\n        - ""\n        resources:\n        - endpoints\n        - services\n        - pods\n        - namespaces\n        verbs:\n        - list\n        - watch\n      - apiGroups:\n        - discovery.k8s.io\n        resources:\n        - endpointslices\n        verbs:\n        - list\n        - watch\n      - apiGroups:\n        - ""\n        resources:\n        - nodes\n        verbs:\n        - get\n  - id: clusterRoleBinding\n    template:\n      apiVersion: rbac.authorization.k8s.io/v1\n      kind: ClusterRoleBinding\n      metadata:\n        name: ${schema.spec.name}\n        labels: ${schema.spec.values.clusterRole.labels}\n        annotations: ${schema.spec.values.clusterRoleBinding.annotations}\n      roleRef:\n        apiGroup: rbac.authorization.k8s.io\n        kind: ClusterRole\n        name: ${clusterRole.metadata.name}\n      subjects:\n      - kind: ServiceAccount\n        name: ${serviceAccount.metadata.name}\n        namespace: ${serviceAccount.metadata.namespace}\n  - id: configMap\n    template:\n      apiVersion: v1\n      kind: ConfigMap\n      metadata:\n        name: ${schema.spec.name}\n        labels: ${schema.spec.values.configMap.labels}\n      data:\n        Corefile: |-\n          .:53 {\n              errors\n              health\n              kubernetes cluster.local in-addr.arpa ip6.arpa {\n                pods insecure\n                fallthrough in-addr.arpa ip6.arpa\n              }\n              prometheus :9153\n              forward . /etc/resolv.conf\n              cache 30\n              loop\n              reload\n              loadbalance\n          }\n  - id: deployment\n    template:\n      apiVersion: apps/v1\n      kind: Deployment\n      metadata:\n        annotations: ${schema.spec.values.deployment.annotations}\n        labels: ${schema.spec.values.deployment.labels}\n        name: ${schema.spec.name}\n      spec:\n        replicas: ${schema.spec.values.deployment.replicas}\n        selector:\n          matchLabels: ${schema.spec.values.configMap.labels}\n        template:\n          metadata:\n            labels: ${schema.spec.values.configMap.labels}\n          spec:\n            serviceAccountName: ${serviceAccount.metadata.name}\n            containers:\n            - name: "coredns"\n              image: ${schema.spec.values.image.repository}:${schema.spec.values.image.tag}\n              args: ["-conf", "/etc/coredns/Corefile"]\n              resources: ${schema.spec.values.resources}\n              volumeMounts:\n              - name: config-volume\n                mountPath: /etc/coredns\n            volumes:\n              - name: config-volume\n                configMap:\n                  name: ${schema.spec.name}\n                  items:\n                  - key: Corefile\n                    path: Corefile\n  - id: service\n    template:\n      apiVersion: v1\n      kind: Service\n      metadata:\n        name: ${schema.spec.name}\n        labels: ${schema.spec.values.service.labels}\n        annotations: ${schema.spec.values.service.annotations}\n      spec:\n        selector:\n          k8s-app: kube-dns\n        clusterIP: ${schema.spec.values.service.clusterIP}\n        clusterIPs: ${schema.spec.values.service.clusterIPs}\n        internalTrafficPolicy: Cluster\n        ipFamilies: ${schema.spec.values.service.ipFamilies}\n        ports:\n        - name: dns\n          port: 53\n          protocol: UDP\n          targetPort: 53\n        - name: dns-tcp\n          port: 53\n          protocol: TCP\n          targetPort: 53\n        selector:\n         k8s-app: kube-dns\n        sessionAffinity: None\n  - id: serviceAccount\n    template:\n      apiVersion: v1\n      kind: ServiceAccount\n      metadata:\n        name: ${schema.spec.name}\n        namespace: ${schema.spec.namespace}\n        labels: ${schema.spec.values.configMap.labels}\n      secrets:\n      - ${schema.spec.values.serviceAccount.secrets}\n'})})]})}function m(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(p,{...e})}):p(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>c});var a=s(96540);const t={},r=a.createContext(t);function o(e){const n=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);