"use strict";(self.webpackChunkkro_docs=self.webpackChunkkro_docs||[]).push([[1642],{52121:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>c,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"examples/aws/ack-eks-cluster","title":"EKS Cluster","description":"","source":"@site/versioned_docs/version-0.6.2/examples/aws/ack-eks-cluster.md","sourceDirName":"examples/aws","slug":"/examples/aws/ack-eks-cluster","permalink":"/0.6.2/examples/aws/ack-eks-cluster","draft":false,"unlisted":false,"editUrl":"https://github.com/kubernetes-sigs/kro/tree/main/website/versioned_docs/version-0.6.2/examples/aws/ack-eks-cluster.md","tags":[],"version":"0.6.2","sidebarPosition":302,"frontMatter":{"sidebar_position":302},"sidebar":"examplesSidebar","previous":{"title":"aws-examples","permalink":"/0.6.2/examples/aws/aws-examples"},"next":{"title":"Networking Stack","permalink":"/0.6.2/examples/aws/ack-networking-stack"}}');var a=s(74848),r=s(28453);const c={sidebar_position:302},i="EKS Cluster",l={},o=[];function u(e){const n={code:"code",h1:"h1",header:"header",pre:"pre",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"eks-cluster",children:"EKS Cluster"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="eks.yaml"',children:'apiVersion: kro.run/v1alpha1\nkind: ResourceGraphDefinition\nmetadata:\n  name: ekscluster.kro.run\nspec:\n  # CRD Schema\n  schema:\n    apiVersion: v1alpha1\n    kind: EKSCluster\n    spec:\n      name: string\n      version: string\n    status:\n      networkingInfo:\n        vpcID: ${clusterVPC.status.vpcID}\n        subnetAZA: ${clusterSubnetA.status.subnetID}\n        subnetAZB: ${clusterSubnetB.status.subnetID}\n      clusterARN: ${cluster.status.ackResourceMetadata.arn}\n  # resources\n  resources:\n    - id: clusterVPC\n      readyWhen:\n        - ${clusterVPC.status.state == "available"}\n      template:\n        apiVersion: ec2.services.k8s.aws/v1alpha1\n        kind: VPC\n        metadata:\n          name: kro-cluster-vpc\n        spec:\n          cidrBlocks:\n            - 192.168.0.0/16\n          enableDNSSupport: true\n          enableDNSHostnames: true\n    - id: clusterElasticIPAddress\n      template:\n        apiVersion: ec2.services.k8s.aws/v1alpha1\n        kind: ElasticIPAddress\n        metadata:\n          name: kro-cluster-eip\n        spec: {}\n    - id: clusterInternetGateway\n      template:\n        apiVersion: ec2.services.k8s.aws/v1alpha1\n        kind: InternetGateway\n        metadata:\n          name: kro-cluster-igw\n        spec:\n          vpc: ${clusterVPC.status.vpcID}\n    - id: clusterRouteTable\n      template:\n        apiVersion: ec2.services.k8s.aws/v1alpha1\n        kind: RouteTable\n        metadata:\n          name: kro-cluster-public-route-table\n        spec:\n          vpcID: ${clusterVPC.status.vpcID}\n          routes:\n            - destinationCIDRBlock: 0.0.0.0/0\n              gatewayID: ${clusterInternetGateway.status.internetGatewayID}\n    - id: clusterSubnetA\n      readyWhen:\n        - ${clusterSubnetA.status.state == "available"}\n      template:\n        apiVersion: ec2.services.k8s.aws/v1alpha1\n        kind: Subnet\n        metadata:\n          name: kro-cluster-public-subnet1\n        spec:\n          availabilityZone: us-west-2a\n          cidrBlock: 192.168.0.0/18\n          vpcID: ${clusterVPC.status.vpcID}\n          routeTables:\n            - ${clusterRouteTable.status.routeTableID}\n          mapPublicIPOnLaunch: true\n    - id: clusterSubnetB\n      template:\n        apiVersion: ec2.services.k8s.aws/v1alpha1\n        kind: Subnet\n        metadata:\n          name: kro-cluster-public-subnet2\n        spec:\n          availabilityZone: us-west-2b\n          cidrBlock: 192.168.64.0/18\n          vpcID: ${clusterVPC.status.vpcID}\n          routeTables:\n            - ${clusterRouteTable.status.routeTableID}\n          mapPublicIPOnLaunch: true\n    - id: clusterNATGateway\n      template:\n        apiVersion: ec2.services.k8s.aws/v1alpha1\n        kind: NATGateway\n        metadata:\n          name: kro-cluster-natgateway1\n        spec:\n          subnetID: ${clusterSubnetB.status.subnetID}\n          allocationID: ${clusterElasticIPAddress.status.allocationID}\n    - id: clusterRole\n      template:\n        apiVersion: iam.services.k8s.aws/v1alpha1\n        kind: Role\n        metadata:\n          name: kro-cluster-role\n        spec:\n          name: kro-cluster-role\n          description: "kro created cluster cluster role"\n          policies:\n            - arn:aws:iam::aws:policy/AmazonEKSClusterPolicy\n          assumeRolePolicyDocument: |\n            {\n              "Version": "2012-10-17",\n              "Statement": [\n                {\n                  "Effect": "Allow",\n                  "Principal": {\n                    "Service": "eks.amazonaws.com"\n                  },\n                  "Action": "sts:AssumeRole"\n                }\n              ]\n            }\n    - id: clusterNodeRole\n      template:\n        apiVersion: iam.services.k8s.aws/v1alpha1\n        kind: Role\n        metadata:\n          name: kro-cluster-node-role\n        spec:\n          name: kro-cluster-node-role\n          description: "kro created cluster node role"\n          policies:\n            - arn:aws:iam::aws:policy/AmazonEKSWorkerNodePolicy\n            - arn:aws:iam::aws:policy/AmazonEC2ContainerRegistryReadOnly\n            - arn:aws:iam::aws:policy/AmazonEKS_CNI_Policy\n          assumeRolePolicyDocument: |\n            {\n              "Version": "2012-10-17",\n              "Statement": [\n                {\n                  "Effect": "Allow",\n                  "Principal": {\n                    "Service": "ec2.amazonaws.com"\n                  },\n                  "Action": "sts:AssumeRole"\n                }\n              ]\n            }\n    - id: clusterAdminRole\n      template:\n        apiVersion: iam.services.k8s.aws/v1alpha1\n        kind: Role\n        metadata:\n          name: kro-cluster-pia-role\n        spec:\n          name: kro-cluster-pia-role\n          description: "kro created cluster admin pia role"\n          policies:\n            - arn:aws:iam::aws:policy/AdministratorAccess\n          assumeRolePolicyDocument: |\n            {\n                "Version": "2012-10-17",\n                "Statement": [\n                    {\n                        "Sid": "AllowEksAuthToAssumeRoleForPodIdentity",\n                        "Effect": "Allow",\n                        "Principal": {\n                            "Service": "pods.eks.amazonaws.com"\n                        },\n                        "Action": [\n                            "sts:AssumeRole",\n                            "sts:TagSession"\n                        ]\n                    }\n                ]\n            }\n    - id: cluster\n      readyWhen:\n        - ${cluster.status.status == "ACTIVE"}\n      template:\n        apiVersion: eks.services.k8s.aws/v1alpha1\n        kind: Cluster\n        metadata:\n          name: ${schema.spec.name}\n        spec:\n          name: ${schema.spec.name}\n          accessConfig:\n            authenticationMode: API_AND_CONFIG_MAP\n          roleARN: ${clusterRole.status.ackResourceMetadata.arn}\n          version: ${schema.spec.version}\n          resourcesVPCConfig:\n            endpointPrivateAccess: false\n            endpointPublicAccess: true\n            subnetIDs:\n              - ${clusterSubnetA.status.subnetID}\n              - ${clusterSubnetB.status.subnetID}\n    - id: clusterNodeGroup\n      template:\n        apiVersion: eks.services.k8s.aws/v1alpha1\n        kind: Nodegroup\n        metadata:\n          name: kro-cluster-nodegroup\n        spec:\n          name: kro-cluster-ng\n          diskSize: 100\n          clusterName: ${cluster.spec.name}\n          subnets:\n            - ${clusterSubnetA.status.subnetID}\n            - ${clusterSubnetB.status.subnetID}\n          nodeRole: ${clusterNodeRole.status.ackResourceMetadata.arn}\n          updateConfig:\n            maxUnavailable: 1\n          scalingConfig:\n            minSize: 1\n            maxSize: 1\n            desiredSize: 1\n'})})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>i});var t=s(96540);const a={},r=t.createContext(a);function c(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:c(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);