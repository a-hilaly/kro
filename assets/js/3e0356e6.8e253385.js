"use strict";(self.webpackChunkkro_docs=self.webpackChunkkro_docs||[]).push([[7080],{44025:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>d,default:()=>p,frontMatter:()=>o,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"docs/concepts/rgd/dependencies-ordering","title":"Graph Inference","description":"kro automatically infers dependencies from CEL expressions. You don\'t specify the order - you describe relationships, and kro figures out the rest.","source":"@site/docs/docs/concepts/rgd/04-dependencies-ordering.md","sourceDirName":"docs/concepts/rgd","slug":"/docs/concepts/rgd/dependencies-ordering","permalink":"/next/docs/concepts/rgd/dependencies-ordering","draft":false,"unlisted":false,"editUrl":"https://github.com/kubernetes-sigs/kro/tree/main/website/docs/docs/concepts/rgd/04-dependencies-ordering.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"docsSidebar","previous":{"title":"CEL Expressions","permalink":"/next/docs/concepts/rgd/cel-expressions"},"next":{"title":"Static Analysis","permalink":"/next/docs/concepts/rgd/static-type-checking"}}');var c=s(74848),i=s(28453);const o={sidebar_position:4},d="Graph Inference",t={},a=[{value:"How It Works",id:"how-it-works",level:2},{value:"Dependency Graph (DAG)",id:"dependency-graph-dag",level:2},{value:"Topological Order",id:"topological-order",level:2},{value:"Circular Dependencies",id:"circular-dependencies",level:2},{value:"What Happens at Runtime",id:"what-happens-at-runtime",level:2},{value:"Next Steps",id:"next-steps",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"graph-inference",children:"Graph Inference"})}),"\n",(0,c.jsx)(n.p,{children:"kro automatically infers dependencies from CEL expressions. You don't specify the order - you describe relationships, and kro figures out the rest."}),"\n",(0,c.jsx)(n.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,c.jsx)(n.p,{children:"When you reference one resource from another using a CEL expression, you create a dependency:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:"resources:\n  - id: configmap\n    template:\n      apiVersion: v1\n      kind: ConfigMap\n      metadata:\n        name: app-config\n      data:\n        DATABASE_URL: ${schema.spec.dbUrl}\n\n  - id: deployment\n    template:\n      apiVersion: apps/v1\n      kind: Deployment\n      spec:\n        containers:\n          - env:\n              - name: DATABASE_URL\n                value: ${configmap.data.DATABASE_URL}\n"})}),"\n",(0,c.jsxs)(n.p,{children:["The expression ",(0,c.jsx)(n.code,{children:"${configmap.data.DATABASE_URL}"})," creates a dependency: ",(0,c.jsx)(n.code,{children:"deployment"})," depends on ",(0,c.jsx)(n.code,{children:"configmap"}),". kro will create the configmap first, wait for the expression to be resolvable, then create the deployment."]}),"\n",(0,c.jsx)(n.h2,{id:"dependency-graph-dag",children:"Dependency Graph (DAG)"}),"\n",(0,c.jsx)(n.p,{children:"kro builds a Directed Acyclic Graph (DAG) where:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Nodes"})," are resources"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Edges"})," are dependencies"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Directed"})," means dependencies have direction (A depends on B)"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Acyclic"})," means no circular dependencies"]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"Simple chain:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"schema \u2192 configmap \u2192 deployment \u2192 service \u2192 ingress\n"})}),"\n",(0,c.jsx)(n.p,{children:"Multiple dependencies:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"        schema\n          \u2193\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2193           \u2193\ndatabase     cache\n    \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518\n          \u2193\n         app\n"})}),"\n",(0,c.jsx)(n.h2,{id:"topological-order",children:"Topological Order"}),"\n",(0,c.jsx)(n.p,{children:"kro computes a topological order - the sequence resources can be processed such that all dependencies are satisfied."}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"Creation:"})," Resources created in topological order\n",(0,c.jsx)(n.strong,{children:"Deletion:"})," Resources deleted in reverse order"]}),"\n",(0,c.jsx)(n.p,{children:"View the computed order:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"kubectl get rgd my-app -o jsonpath='{.status.topologicalOrder}'\n"})}),"\n",(0,c.jsx)(n.p,{children:"Example output:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:"status:\n  topologicalOrder:\n    - configmap\n    - deployment\n    - service\n"})}),"\n",(0,c.jsx)(n.h2,{id:"circular-dependencies",children:"Circular Dependencies"}),"\n",(0,c.jsx)(n.p,{children:"Circular dependencies are not allowed and will cause validation to fail:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:"# \u2717 This will fail\nresources:\n  - id: serviceA\n    template:\n      spec:\n        targetPort: ${serviceB.spec.port}  # A \u2192 B\n\n  - id: serviceB\n    template:\n      spec:\n        targetPort: ${serviceA.spec.port}  # B \u2192 A (circular!)\n"})}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"Fix:"})," Break the cycle by using ",(0,c.jsx)(n.code,{children:"schema.spec"})," instead:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:"resources:\n  - id: serviceA\n    template:\n      spec:\n        targetPort: ${schema.spec.portA}  # Use schema\n\n  - id: serviceB\n    template:\n      spec:\n        targetPort: ${serviceA.spec.port}  # This is fine\n"})}),"\n",(0,c.jsx)(n.h2,{id:"what-happens-at-runtime",children:"What Happens at Runtime"}),"\n",(0,c.jsx)(n.p,{children:"When kro reconciles an instance:"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Evaluate static expressions"})," - Expressions referencing only ",(0,c.jsx)(n.code,{children:"schema.spec"})," are evaluated once"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Process in topological order"})," - For each resource:","\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Wait for all dependency expressions to be resolvable"}),"\n",(0,c.jsx)(n.li,{children:"Create or update the resource"}),"\n",(0,c.jsx)(n.li,{children:"Move to next resource in order"}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Delete in reverse order"})," - During deletion, process resources backwards"]}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:["kro waits for CEL expressions to be ",(0,c.jsx)(n.strong,{children:"resolvable"})," before proceeding. This means the referenced resource exists and has the field being accessed."]}),"\n",(0,c.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:(0,c.jsx)(n.a,{href:"/next/docs/concepts/rgd/resource-definitions/readiness",children:"Readiness"})})," - Control when resources are considered ready with ",(0,c.jsx)(n.code,{children:"readyWhen"})]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:(0,c.jsx)(n.a,{href:"/next/docs/concepts/rgd/cel-expressions",children:"CEL Expressions"})})," - Learn more about writing expressions"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:(0,c.jsx)(n.a,{href:"/next/docs/concepts/rgd/resource-definitions/resource-basics",children:"Resource Basics"})})," - Learn about resource templates"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(l,{...e})}):l(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>d});var r=s(96540);const c={},i=r.createContext(c);function o(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:o(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);