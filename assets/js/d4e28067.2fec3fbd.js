"use strict";(self.webpackChunkkro_docs=self.webpackChunkkro_docs||[]).push([[4743],{75235:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"docs/advanced/access-control","title":"Access Control","description":"There are currently two modes of access control supported by kro, if you","source":"@site/docs/docs/advanced/01-access-control.md","sourceDirName":"docs/advanced","slug":"/docs/advanced/access-control","permalink":"/kro/next/docs/advanced/access-control","draft":false,"unlisted":false,"editUrl":"https://github.com/kubernetes-sigs/kro/tree/main/website/docs/docs/advanced/01-access-control.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"docsSidebar","previous":{"title":"Instances","permalink":"/kro/next/docs/concepts/instances"},"next":{"title":"RGD Chaining","permalink":"/kro/next/docs/advanced/rgd-chaining"}}');var o=s(74848),c=s(28453);const t={sidebar_position:1},i="Access Control",a={},d=[{value:"<code>unrestricted</code> Access",id:"unrestricted-access",level:2},{value:"<code>aggregation</code> Access",id:"aggregation-access",level:2},{value:"Example",id:"example",level:3}];function l(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"access-control",children:"Access Control"})}),"\n",(0,o.jsxs)(n.p,{children:["There are currently two modes of access control supported by ",(0,o.jsx)(n.strong,{children:"kro"}),", if you\n",(0,o.jsx)(n.a,{href:"/kro/next/docs/getting-started/Installation#installation",children:"install through the Helm chart"}),":"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.code,{children:"unrestricted"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.code,{children:"aggregation"})}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["The mode is selected with a ",(0,o.jsx)(n.code,{children:"values"})," property ",(0,o.jsx)(n.code,{children:"rbac.mode"}),", and defaults to ",(0,o.jsx)(n.code,{children:"unrestricted"}),"."]}),"\n",(0,o.jsxs)(n.h2,{id:"unrestricted-access",children:[(0,o.jsx)(n.code,{children:"unrestricted"})," Access"]}),"\n",(0,o.jsxs)(n.p,{children:["In the ",(0,o.jsx)(n.code,{children:"unrestricted"})," access mode, the chart includes a ",(0,o.jsx)(n.code,{children:"ClusterRole"})," granting\n",(0,o.jsx)(n.strong,{children:"kro"})," ",(0,o.jsx)(n.em,{children:"full control to every resource type in your cluster"}),". This can be\nuseful for experimenting in a test environment, where access control is not\nnecessary, but is not recommended in a production environment."]}),"\n",(0,o.jsxs)(n.p,{children:["In this mode, anyone with access to create ",(0,o.jsx)(n.code,{children:"ResourceGraphDefinition"})," resources,\neffectively also has admin access to the cluster."]}),"\n",(0,o.jsxs)(n.h2,{id:"aggregation-access",children:[(0,o.jsx)(n.code,{children:"aggregation"})," Access"]}),"\n",(0,o.jsxs)(n.p,{children:["In the ",(0,o.jsx)(n.code,{children:"aggregation"})," access mode, the chart includes an ",(0,o.jsxs)(n.a,{href:"https://kubernetes.io/docs/reference/access-authn-authz/rbac/#aggregated-clusterroles",children:[(0,o.jsx)(n.em,{children:"aggregated"})," ",(0,o.jsx)(n.code,{children:"ClusterRole"})]}),"\nwhich dynamically includes all rules from all ",(0,o.jsx)(n.code,{children:"ClusterRoles"})," that have the label\n",(0,o.jsx)(n.code,{children:'rbac.kro.run/aggregate-to-controller: "true"'}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["There is a very minimal set of permissions provisioned by the chart itself, just\nenough to let ",(0,o.jsx)(n.strong,{children:"kro"})," run at all: full permissions for ",(0,o.jsx)(n.code,{children:"ResourceGraphDefinition"}),"s\nand its subresources, and full permissions for ",(0,o.jsx)(n.code,{children:"CustomResourceDefinitions"})," as\n",(0,o.jsx)(n.strong,{children:"kro"})," will create them in response to the existence of an RGD."]}),"\n",(0,o.jsxs)(n.p,{children:["However, this does ",(0,o.jsx)(n.em,{children:"not"})," automatically set up permissions for ",(0,o.jsx)(n.strong,{children:"kro"})," to actually\nreconcile those generated CRDs! In other words, when using this mode, you will\nneed to provision additional access for ",(0,o.jsx)(n.strong,{children:"kro"})," for every new resource type you\ndefine."]}),"\n",(0,o.jsx)(n.h3,{id:"example",children:"Example"}),"\n",(0,o.jsxs)(n.p,{children:["If you want to create a ",(0,o.jsx)(n.code,{children:"ResourceGraphDefinition"})," that specifies a new resource\ntype with ",(0,o.jsx)(n.code,{children:"kind: Foo"}),", and where the graph includes an ",(0,o.jsx)(n.code,{children:"apps/v1/Deployment"})," and\na ",(0,o.jsx)(n.code,{children:"v1/ConfigMap"}),", you will need to create the following ",(0,o.jsx)(n.code,{children:"ClusterRole"})," to ensure\n",(0,o.jsx)(n.strong,{children:"kro"})," has enough access to reconcile your resources:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'apiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  labels:\n    rbac.kro.run/aggregate-to-controller: "true"\n  name: kro:controller:foos\nrules:\n  - apiGroups:\n      - kro.run\n    resources:\n      - foos\n    verbs:\n      - "*"\n  - apiGroups:\n      - apps\n    resources:\n      - deployments\n    verbs:\n      - "*"\n  - apiGroups:\n      - ""\n    resources:\n      - configmaps\n    verbs:\n      - "*"\n'})})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>i});var r=s(96540);const o={},c=r.createContext(o);function t(e){const n=r.useContext(c);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),r.createElement(c.Provider,{value:n},e.children)}}}]);