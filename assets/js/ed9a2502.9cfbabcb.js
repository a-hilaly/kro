"use strict";(self.webpackChunkkro_docs=self.webpackChunkkro_docs||[]).push([[1423],{63076:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>p,frontMatter:()=>c,metadata:()=>s,toc:()=>h});const s=JSON.parse('{"id":"docs/concepts/rgd/resource-definitions/collections","title":"Collections","description":"By default, each resource definition (in spec.resources) creates exactly one","source":"@site/docs/docs/concepts/rgd/02-resource-definitions/04-collections.md","sourceDirName":"docs/concepts/rgd/02-resource-definitions","slug":"/docs/concepts/rgd/resource-definitions/collections","permalink":"/kro/next/docs/concepts/rgd/resource-definitions/collections","draft":false,"unlisted":false,"editUrl":"https://github.com/kubernetes-sigs/kro/tree/main/website/docs/docs/concepts/rgd/02-resource-definitions/04-collections.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"docsSidebar","previous":{"title":"Readiness","permalink":"/kro/next/docs/concepts/rgd/resource-definitions/readiness"},"next":{"title":"External References","permalink":"/kro/next/docs/concepts/rgd/resource-definitions/external-references"}}');var a=r(74848),t=r(28453),i=r(11470),o=r(19365);const c={sidebar_position:4},l="Collections",d={},h=[{value:"Basic Example",id:"basic-example",level:2},{value:"forEach Syntax",id:"foreach-syntax",level:2},{value:"Iteration Context Variables",id:"iteration-context-variables",level:2},{value:"How forEach Works",id:"how-foreach-works",level:2},{value:"Iterating Over Arrays",id:"iterating-over-arrays",level:3},{value:"Iterating Over Maps",id:"iterating-over-maps",level:3},{value:"Multiple Iterators (Cartesian Product)",id:"multiple-iterators-cartesian-product",level:2},{value:"Supported Collection Types",id:"supported-collection-types",level:2},{value:"Referencing Collections",id:"referencing-collections",level:2},{value:"In a Resource",id:"in-a-resource",level:3},{value:"In Another Collection",id:"in-another-collection",level:3},{value:"Dependency Behavior",id:"dependency-behavior",level:3},{value:"Readiness with Collections",id:"readiness-with-collections",level:2},{value:"Aggregate Readiness Patterns",id:"aggregate-readiness-patterns",level:3},{value:"Conditional Collections",id:"conditional-collections",level:2},{value:"Exposing Collection Data in Instance Status",id:"exposing-collection-data-in-instance-status",level:2},{value:"Next Steps",id:"next-steps",level:2}];function u(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"collections",children:"Collections"})}),"\n",(0,a.jsxs)(n.p,{children:["By default, each resource definition (in ",(0,a.jsx)(n.code,{children:"spec.resources"}),") creates exactly one\nKubernetes resource. This means the number of resources is fixed at design\ntime - if you need 5 worker Pods, you write 5 resource definitions."]}),"\n",(0,a.jsx)(n.p,{children:"Collections let you declaratively manage multiple similar resources from a\nsingle definition. This is useful when the number of resources depends on\nruntime data like availability zones, tenants, or worker counts."}),"\n",(0,a.jsxs)(n.p,{children:["kro provides the ",(0,a.jsx)(n.code,{children:"forEach"})," field to turn any resource into a collection. The\nfield takes one or more iterators, and kro creates one resource for each element\n(or combination of elements), keeping them in sync as the collection changes."]}),"\n",(0,a.jsx)(n.h2,{id:"basic-example",children:"Basic Example"}),"\n",(0,a.jsxs)(n.p,{children:["This RGD uses ",(0,a.jsx)(n.code,{children:"forEach"})," to create multiple Pods from a single resource entry:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kro",children:"apiVersion: kro.run/v1alpha1\nkind: ResourceGraphDefinition\nmetadata:\n  name: worker-pool\nspec:\n  schema:\n    apiVersion: v1alpha1\n    kind: WorkerPool\n    spec:\n      workers: \"[]string\"\n      image: string\n\n  resources:\n    - id: workerPods\n      forEach:\n        - name: ${schema.spec.workers}\n      template:\n        apiVersion: v1\n        kind: Pod\n        metadata:\n          name: ${'worker-' + name.item}\n        spec:\n          containers:\n            - name: app\n              image: ${schema.spec.image}\n"})}),"\n",(0,a.jsxs)(n.p,{children:["When a user creates an instance with ",(0,a.jsx)(n.code,{children:'workers: ["alice", "bob"]'}),", kro creates\ntwo Pods: ",(0,a.jsx)(n.code,{children:"worker-alice"})," and ",(0,a.jsx)(n.code,{children:"worker-bob"}),". If the user later updates the list\nto ",(0,a.jsx)(n.code,{children:'["alice", "bob", "charlie"]'}),", kro creates ",(0,a.jsx)(n.code,{children:"worker-charlie"})," to match."]}),"\n",(0,a.jsx)(n.h2,{id:"foreach-syntax",children:"forEach Syntax"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"forEach"})," field is an array of iterators. Each iterator is defined as\n",(0,a.jsx)(n.code,{children:"variableName: ${expression}"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kro",children:"forEach:\n  - region: ${schema.spec.regions}\n"})}),"\n",(0,a.jsx)(n.admonition,{type:"tip",children:(0,a.jsx)(n.p,{children:"Use descriptive names that reflect what you're iterating over. The variable name\nbecomes available in your template expressions."})}),"\n",(0,a.jsx)(n.h2,{id:"iteration-context-variables",children:"Iteration Context Variables"}),"\n",(0,a.jsx)(n.p,{children:"Each iterator provides access to the current element through the variable name\nyou specify:"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Variable"}),(0,a.jsx)(n.th,{children:"Description"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"{name}.item"})}),(0,a.jsx)(n.td,{children:"The current element being iterated over"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"{name}.index"})}),(0,a.jsx)(n.td,{children:"The zero-based index (for arrays)"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"{name}.key"})}),(0,a.jsx)(n.td,{children:"The key (for maps)"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"{name}.value"})}),(0,a.jsxs)(n.td,{children:["The value (for maps, same as ",(0,a.jsx)(n.code,{children:".item"}),")"]})]})]})]}),"\n",(0,a.jsx)(n.h2,{id:"how-foreach-works",children:"How forEach Works"}),"\n",(0,a.jsxs)(n.p,{children:["When you add ",(0,a.jsx)(n.code,{children:"forEach"})," to a resource, kro treats that resource block as a\ntemplate for multiple resources rather than a single one."]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"At RGD validation time (static analysis)"}),", kro analyzes the ",(0,a.jsx)(n.code,{children:"forEach"}),"\nexpressions to determine the element types. If ",(0,a.jsx)(n.code,{children:"schema.spec.workers"})," is\n",(0,a.jsx)(n.code,{children:"[]string"}),", kro knows each iteration yields a string and types the iterator\nvariable accordingly. This enables ",(0,a.jsx)(n.a,{href:"/kro/next/docs/concepts/rgd/static-type-checking",children:"static type checking"}),"\nof expressions inside the template before any resources are created."]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"At instance reconciliation time (runtime)"}),", when the reconciler reaches a\ncollection node in the dependency graph:"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Evaluates each forEach CEL expression to get the current collections"}),"\n",(0,a.jsx)(n.li,{children:"Expands into multiple resource operations - one per element (or combination)"}),"\n",(0,a.jsx)(n.li,{children:"Compares against existing resources and creates, updates, or deletes as\nneeded"}),"\n",(0,a.jsxs)(n.li,{children:["Evaluates ",(0,a.jsx)(n.code,{children:"readyWhen"})," (if specified) across all collection resources before\nproceeding to dependent nodes"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Each resource in the collection is tracked independently. If one resource fails\nto reconcile, the others continue - kro doesn't require all-or-nothing success\nwithin a collection."}),"\n",(0,a.jsx)(n.admonition,{type:"important",children:(0,a.jsxs)(n.p,{children:["In kro, each entry in ",(0,a.jsx)(n.code,{children:"spec.resources"})," is a node in the dependency graph. A\ncollection (a resource with ",(0,a.jsx)(n.code,{children:"forEach"}),") is also a single node in the graph - it\nexpands into multiple resources at runtime, but dependencies treat it as one\nunit."]})}),"\n",(0,a.jsx)(n.h3,{id:"iterating-over-arrays",children:"Iterating Over Arrays"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kro",children:'- id: workerPods\n  forEach:\n    - name: ${schema.spec.workers}  # ["alice", "bob", "charlie"]\n  template:\n    kind: Pod\n    metadata:\n      name: ${\'worker-\' + name.item}        # worker-alice, worker-bob, worker-charlie\n      labels:\n        app: ${name.item}                   # alice, bob, charlie\n        index: ${string(name.index)}        # "0", "1", "2"\n'})}),"\n",(0,a.jsx)(n.h3,{id:"iterating-over-maps",children:"Iterating Over Maps"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kro",children:'- id: envConfigMaps\n  forEach:\n    - env: ${schema.spec.environments}  # {"dev": "us-west-1", "prod": "us-east-1"}\n  template:\n    kind: ConfigMap\n    metadata:\n      name: ${\'config-\' + env.key}  # config-dev, config-prod\n    data:\n      environment: ${env.key}        # dev, prod\n      region: ${env.value}           # us-west-1, us-east-1\n'})}),"\n",(0,a.jsx)(n.h2,{id:"multiple-iterators-cartesian-product",children:"Multiple Iterators (Cartesian Product)"}),"\n",(0,a.jsx)(n.p,{children:"When you specify multiple iterators, kro creates resources for every combination\n(cartesian product) of values:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kro",children:'- id: deployments\n  forEach:\n    - region: ${schema.spec.regions}  # ["us-east", "us-west"]\n    - tier: ${schema.spec.tiers}      # ["web", "api"]\n  template:\n    kind: Deployment\n    metadata:\n      # Creates 4 deployments: us-east-web, us-east-api, us-west-web, us-west-api\n      name: ${region.item + \'-\' + tier.item}\n    spec:\n      template:\n        spec:\n          containers:\n            - name: app\n              image: ${schema.spec.image}\n              env:\n                - name: REGION\n                  value: ${region.item}\n                - name: TIER\n                  value: ${tier.item}\n'})}),"\n",(0,a.jsxs)(n.p,{children:["With ",(0,a.jsx)(n.code,{children:'regions: ["us-east", "us-west"]'})," and ",(0,a.jsx)(n.code,{children:'tiers: ["web", "api"]'}),", this creates\n4 deployments covering all combinations."]}),"\n",(0,a.jsx)(n.admonition,{type:"important",children:(0,a.jsxs)(n.p,{children:["If any iterator's collection is empty, zero resources are created. This follows\nstandard cartesian product behavior: ",(0,a.jsx)(n.code,{children:"2 \xd7 0 = 0"}),"."]})}),"\n",(0,a.jsx)(n.h2,{id:"supported-collection-types",children:"Supported Collection Types"}),"\n",(0,a.jsx)(n.p,{children:"The iterator expression can evaluate to arrays or maps from various sources:"}),"\n",(0,a.jsxs)(i.A,{children:[(0,a.jsx)(o.A,{value:"instance-spec",label:"Instance Spec",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kro",children:"spec:\n  schema:\n    spec:\n      regions: \"[]string\"\n  resources:\n    - id: regionalConfigs\n      forEach:\n        - region: ${schema.spec.regions}\n      template:\n        kind: ConfigMap\n        metadata:\n          name: ${'config-' + region.item}\n"})})}),(0,a.jsx)(o.A,{value:"resource-spec",label:"Resource Spec",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kro",children:"resources:\n  - id: database\n    template:\n      apiVersion: db.example.com/v1\n      kind: Database\n      spec:\n        shards:\n          - name: users\n            region: us-east\n          - name: orders\n            region: us-west\n\n  - id: shardBackups\n    forEach:\n      - shard: ${database.spec.shards}\n    template:\n      kind: CronJob\n      metadata:\n        name: ${'backup-' + shard.item.name}\n      spec:\n        schedule: \"0 2 * * *\"\n        # ...\n"})})}),(0,a.jsx)(o.A,{value:"resource-status",label:"Resource Status",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kro",children:"resources:\n  - id: cluster\n    template:\n      apiVersion: kafka.example.com/v1\n      kind: KafkaCluster\n      spec:\n        brokers: 3\n\n  - id: brokerServices\n    forEach:\n      - broker: ${cluster.status.brokers}\n    template:\n      kind: Service\n      metadata:\n        name: ${'kafka-broker-' + string(broker.index)}\n      spec:\n        type: ExternalName\n        externalName: ${broker.item.host}\n"})})}),(0,a.jsx)(o.A,{value:"array",label:"Array Literal",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kro",children:'resources:\n  - id: zoneConfigs\n    forEach:\n      - zone: ${["us-east-1a", "us-east-1b", "us-east-1c"]}\n    template:\n      kind: ConfigMap\n      metadata:\n        name: ${\'config-\' + zone.item}\n\n  - id: shards\n    forEach:\n      - num: ${range(0, 3)}  # CEL function that returns [0, 1, 2]\n    template:\n      kind: StatefulSet\n      metadata:\n        name: ${\'db-shard-\' + string(num.item)}\n'})})}),(0,a.jsx)(o.A,{value:"map",label:"Map Literal",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kro",children:'resources:\n  - id: envConfigs\n    forEach:\n      - env: ${{"prod": "us-east-1", "staging": "us-west-2"}}\n    template:\n      kind: ConfigMap\n      metadata:\n        name: ${\'config-\' + env.key}\n      data:\n        region: ${env.value}\n'})})})]}),"\n",(0,a.jsx)(n.h2,{id:"referencing-collections",children:"Referencing Collections"}),"\n",(0,a.jsxs)(n.p,{children:["Other resources can reference a collection by its ID. The collection exposes\nall created resources as an array, which you can use with CEL functions like\n",(0,a.jsx)(n.code,{children:"map()"}),", ",(0,a.jsx)(n.code,{children:"filter()"}),", and ",(0,a.jsx)(n.code,{children:"all()"}),"."]}),"\n",(0,a.jsx)(n.h3,{id:"in-a-resource",children:"In a Resource"}),"\n",(0,a.jsx)(n.p,{children:"Use CEL functions to aggregate collection data into a single resource:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kro",children:"- id: workerPods\n  forEach:\n    - name: ${schema.spec.workers}\n  template:\n    kind: Pod\n    metadata:\n      name: ${'worker-' + name.item}\n    # ...\n\n- id: summary\n  template:\n    kind: ConfigMap\n    metadata:\n      name: worker-summary\n    data:\n      podNames: ${workerPods.map(p, p.metadata.name).join(', ')}\n      count: ${string(size(workerPods))}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"in-another-collection",children:"In Another Collection"}),"\n",(0,a.jsx)(n.p,{children:"One collection can iterate over another to create dependent resources:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kro",children:"- id: databases\n  forEach:\n    - db: ${schema.spec.databases}\n  template:\n    apiVersion: db.example.com/v1\n    kind: Database\n    metadata:\n      name: ${db.item.name}\n    spec:\n      storage: ${db.item.storage}\n\n- id: backupJobs\n  forEach:\n    - db: ${databases}  # iterate over the collection\n  template:\n    kind: CronJob\n    metadata:\n      name: ${'backup-' + db.item.metadata.name}\n    spec:\n      schedule: \"0 2 * * *\"\n      jobTemplate:\n        spec:\n          template:\n            spec:\n              containers:\n                - name: backup\n                  env:\n                    - name: DB_HOST\n                      value: ${db.item.status.endpoint}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"dependency-behavior",children:"Dependency Behavior"}),"\n",(0,a.jsxs)(n.p,{children:["Like references in templates, resource references in ",(0,a.jsx)(n.code,{children:"forEach"})," expressions\ncreate edges in the dependency graph. Any reference between a resource and a\ncollection - whether in the ",(0,a.jsx)(n.code,{children:"forEach"})," expression or in the template - causes\nkro to wait for the referenced collection to be fully reconciled and ready\n(",(0,a.jsx)(n.code,{children:"readyWhen"})," resolves to true) before proceeding:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kro",children:"resources:\n  # Collection A: creates multiple databases\n  - id: databases\n    forEach:\n      - db: ${schema.spec.databases}\n    template:\n      kind: Database\n      # ...\n\n  # Collection B: depends on Collection A\n  # kro waits for ALL databases to be ready before creating backup jobs\n  - id: backupJobs\n    forEach:\n      - db: ${databases}\n    template:\n      kind: CronJob\n      # ...\n\n  # Resource C: depends on Collection B\n  # kro waits for ALL backup jobs to be ready before creating the summary\n  - id: summary\n    template:\n      kind: ConfigMap\n      data:\n        backupCount: ${string(size(backupJobs))}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"readiness-with-collections",children:"Readiness with Collections"}),"\n",(0,a.jsxs)(n.p,{children:["For collections, ",(0,a.jsx)(n.code,{children:"readyWhen"})," defines when the entire collection is considered\nready. The expression can reference the collection by its ID to apply aggregate\nconditions across all created resources:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kro",children:"- id: workerPods\n  forEach:\n    - name: ${schema.spec.workers}\n  readyWhen:\n    - ${workerPods.all(w, w.status.phase == 'Running')}\n  template:\n    kind: Pod\n    metadata:\n      name: ${'worker-' + name.item}\n    spec:\n      containers:\n        - name: app\n          image: ${schema.spec.image}\n"})}),"\n",(0,a.jsxs)(n.p,{children:["In this example, ",(0,a.jsx)(n.code,{children:"workerPods"})," is only considered ready when ",(0,a.jsx)(n.strong,{children:"all"})," pods in the\ncollection have ",(0,a.jsx)(n.code,{children:"status.phase == 'Running'"}),". Dependent resources wait for this\ncondition before proceeding."]}),"\n",(0,a.jsx)(n.h3,{id:"aggregate-readiness-patterns",children:"Aggregate Readiness Patterns"}),"\n",(0,a.jsx)(n.p,{children:"Use CEL aggregate functions to express different readiness strategies:"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Pattern"}),(0,a.jsx)(n.th,{children:"Expression"}),(0,a.jsx)(n.th,{children:"Ready When"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"All ready"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"${workers.all(w, w.status.phase == 'Running')}"})}),(0,a.jsx)(n.td,{children:"Every resource matches"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"At least one ready"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"${workers.exists(w, w.status.phase == 'Running')}"})}),(0,a.jsx)(n.td,{children:"Any resource matches"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Minimum count ready"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"${size(workers.filter(w, w.status.phase == 'Running')) >= 3}"})}),(0,a.jsx)(n.td,{children:"N or more match"})]})]})]}),"\n",(0,a.jsx)(n.admonition,{type:"tip",children:(0,a.jsxs)(n.p,{children:["Without ",(0,a.jsx)(n.code,{children:"readyWhen"}),", a collection is considered ready once all resources are\ncreated. Add ",(0,a.jsx)(n.code,{children:"readyWhen"})," when dependent resources need specific conditions to be\ntrue, not just existence."]})}),"\n",(0,a.jsx)(n.h2,{id:"conditional-collections",children:"Conditional Collections"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"includeWhen"})," field operates on the collection as a whole. If the condition\nevaluates to ",(0,a.jsx)(n.code,{children:"false"}),", the entire collection is skipped - no resources are\ncreated. You cannot use ",(0,a.jsx)(n.code,{children:"includeWhen"})," to exclude individual items:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kro",children:"- id: backupJobs\n  includeWhen: ${schema.spec.backupsEnabled}  # all or nothing\n  forEach:\n    - db: ${schema.spec.databases}\n  template:\n    kind: CronJob\n    metadata:\n      name: ${'backup-' + db.item.name}\n    # ...\n"})}),"\n",(0,a.jsxs)(n.p,{children:["To filter individual items from a collection, use ",(0,a.jsx)(n.code,{children:"filter()"})," in the ",(0,a.jsx)(n.code,{children:"forEach"}),"\nexpression:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kro",children:"- id: backupJobs\n  forEach:\n    # Only iterate over databases that have backups enabled\n    - db: ${schema.spec.databases.filter(d, d.backupEnabled)}\n  template:\n    kind: CronJob\n    metadata:\n      name: ${'backup-' + db.item.name}\n    # ...\n"})}),"\n",(0,a.jsx)(n.h2,{id:"exposing-collection-data-in-instance-status",children:"Exposing Collection Data in Instance Status"}),"\n",(0,a.jsx)(n.p,{children:"Status expressions can reference collections to compute aggregate values. This\nlets you expose summary information about the collection in your custom\nresource's status:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kro",children:"spec:\n  schema:\n    apiVersion: v1alpha1\n    kind: WorkerPool\n    spec:\n      workers: \"[]string\"\n    status:\n      total: ${size(workerPods)}\n      running: ${size(workerPods.filter(w, w.status.phase == 'Running'))}\n      ready: ${workerPods.all(w, w.status.phase == 'Running')}\n\n  resources:\n    - id: workerPods\n      forEach:\n        - name: ${schema.spec.workers}\n      template:\n        kind: Pod\n        # ...\n"})}),"\n",(0,a.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.a,{href:"/kro/next/docs/concepts/rgd/resource-definitions/external-references",children:"External References"})})," - Reference existing\nresources not managed by kro"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.a,{href:"/kro/next/docs/concepts/rgd/cel-expressions",children:"CEL Expressions"})})," - Learn about CEL functions\nlike ",(0,a.jsx)(n.code,{children:"range()"}),", ",(0,a.jsx)(n.code,{children:"filter()"}),", and ",(0,a.jsx)(n.code,{children:"map()"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.a,{href:"/kro/next/docs/concepts/rgd/dependencies-ordering",children:"Dependencies & Ordering"})})," - Understand\nhow collections affect the dependency graph"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}},19365:(e,n,r)=>{r.d(n,{A:()=>i});r(96540);var s=r(34164);const a={tabItem:"tabItem_Ymn6"};var t=r(74848);function i({children:e,hidden:n,className:r}){return(0,t.jsx)("div",{role:"tabpanel",className:(0,s.A)(a.tabItem,r),hidden:n,children:e})}},11470:(e,n,r)=>{r.d(n,{A:()=>w});var s=r(96540),a=r(34164),t=r(17559),i=r(23104),o=r(56347),c=r(205),l=r(57485),d=r(31682),h=r(70679);function u(e){return s.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,s.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:n,children:r}=e;return(0,s.useMemo)((()=>{const e=n??function(e){return u(e).map((({props:{value:e,label:n,attributes:r,default:s}})=>({value:e,label:n,attributes:r,default:s})))}(r);return function(e){const n=(0,d.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,r])}function m({value:e,tabValues:n}){return n.some((n=>n.value===e))}function x({queryString:e=!1,groupId:n}){const r=(0,o.W6)(),a=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,l.aZ)(a),(0,s.useCallback)((e=>{if(!a)return;const n=new URLSearchParams(r.location.search);n.set(a,e),r.replace({...r.location,search:n.toString()})}),[a,r])]}function f(e){const{defaultValue:n,queryString:r=!1,groupId:a}=e,t=p(e),[i,o]=(0,s.useState)((()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!m({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const r=n.find((e=>e.default))??n[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:n,tabValues:t}))),[l,d]=x({queryString:r,groupId:a}),[u,f]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[r,a]=(0,h.Dv)(n);return[r,(0,s.useCallback)((e=>{n&&a.set(e)}),[n,a])]}({groupId:a}),g=(()=>{const e=l??u;return m({value:e,tabValues:t})?e:null})();(0,c.A)((()=>{g&&o(g)}),[g]);return{selectedValue:i,selectValue:(0,s.useCallback)((e=>{if(!m({value:e,tabValues:t}))throw new Error(`Can't select invalid tab value=${e}`);o(e),d(e),f(e)}),[d,f,t]),tabValues:t}}var g=r(92303);const b={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var j=r(74848);function k({className:e,block:n,selectedValue:r,selectValue:s,tabValues:t}){const o=[],{blockElementScrollPositionUntilNextRender:c}=(0,i.a_)(),l=e=>{const n=e.currentTarget,a=o.indexOf(n),i=t[a].value;i!==r&&(c(n),s(i))},d=e=>{let n=null;switch(e.key){case"Enter":l(e);break;case"ArrowRight":{const r=o.indexOf(e.currentTarget)+1;n=o[r]??o[0];break}case"ArrowLeft":{const r=o.indexOf(e.currentTarget)-1;n=o[r]??o[o.length-1];break}}n?.focus()};return(0,j.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":n},e),children:t.map((({value:e,label:n,attributes:s})=>(0,j.jsx)("li",{role:"tab",tabIndex:r===e?0:-1,"aria-selected":r===e,ref:e=>{o.push(e)},onKeyDown:d,onClick:l,...s,className:(0,a.A)("tabs__item",b.tabItem,s?.className,{"tabs__item--active":r===e}),children:n??e},e)))})}function v({lazy:e,children:n,selectedValue:r}){const t=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=t.find((e=>e.props.value===r));return e?(0,s.cloneElement)(e,{className:(0,a.A)("margin-top--md",e.props.className)}):null}return(0,j.jsx)("div",{className:"margin-top--md",children:t.map(((e,n)=>(0,s.cloneElement)(e,{key:n,hidden:e.props.value!==r})))})}function y(e){const n=f(e);return(0,j.jsxs)("div",{className:(0,a.A)(t.G.tabs.container,"tabs-container",b.tabList),children:[(0,j.jsx)(k,{...n,...e}),(0,j.jsx)(v,{...n,...e})]})}function w(e){const n=(0,g.A)();return(0,j.jsx)(y,{...e,children:u(e.children)},String(n))}},28453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>o});var s=r(96540);const a={},t=s.createContext(a);function i(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);