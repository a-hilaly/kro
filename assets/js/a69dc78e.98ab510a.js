"use strict";(self.webpackChunkkro_docs=self.webpackChunkkro_docs||[]).push([[8258],{73332:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>p,frontMatter:()=>r,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"docs/concepts/rgd/schema","title":"Schema Definition","description":"The schema section of a ResourceGraphDefinition defines the shape of your custom API. When you create an RGD, kro uses this schema to generate a new Custom Resource Definition (CRD) that users can instantiate.","source":"@site/docs/docs/concepts/rgd/01-schema.md","sourceDirName":"docs/concepts/rgd","slug":"/docs/concepts/rgd/schema","permalink":"/kro/next/docs/concepts/rgd/schema","draft":false,"unlisted":false,"editUrl":"https://github.com/kubernetes-sigs/kro/tree/main/website/docs/docs/concepts/rgd/01-schema.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"docsSidebar","previous":{"title":"Overview","permalink":"/kro/next/docs/concepts/rgd/overview"},"next":{"title":"Basics","permalink":"/kro/next/docs/concepts/rgd/resource-definitions/resource-basics"}}');var t=s(74848),a=s(28453);const r={sidebar_position:1},c="Schema Definition",l={},o=[{value:"What the Schema Defines",id:"what-the-schema-defines",level:2},{value:"Basic Structure",id:"basic-structure",level:2},{value:"API Identification",id:"api-identification",level:2},{value:"Group",id:"group",level:3},{value:"The spec Section",id:"the-spec-section",level:2},{value:"Defining Spec Fields",id:"defining-spec-fields",level:3},{value:"The status Section",id:"the-status-section",level:2},{value:"Status Fields with CEL Expressions",id:"status-fields-with-cel-expressions",level:3},{value:"Structured Status Fields",id:"structured-status-fields",level:3},{value:"Using CEL Functions in Status",id:"using-cel-functions-in-status",level:3},{value:"String Templating in Status",id:"string-templating-in-status",level:3},{value:"Built-in Status Fields",id:"built-in-status-fields",level:3},{value:"How kro Uses the Schema",id:"how-kro-uses-the-schema",level:2},{value:"1. CRD Generation",id:"1-crd-generation",level:3},{value:"2. Instance Validation",id:"2-instance-validation",level:3},{value:"3. Status Updates",id:"3-status-updates",level:3},{value:"Custom Types",id:"custom-types",level:2},{value:"Additional Printer Columns",id:"additional-printer-columns",level:2},{value:"Complete Example",id:"complete-example",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"schema-definition",children:"Schema Definition"})}),"\n",(0,t.jsx)(n.p,{children:"The schema section of a ResourceGraphDefinition defines the shape of your custom API. When you create an RGD, kro uses this schema to generate a new Custom Resource Definition (CRD) that users can instantiate."}),"\n",(0,t.jsx)(n.h2,{id:"what-the-schema-defines",children:"What the Schema Defines"}),"\n",(0,t.jsx)(n.p,{children:"The schema section specifies:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"API identification"}),": The ",(0,t.jsx)(n.code,{children:"apiVersion"}),", ",(0,t.jsx)(n.code,{children:"kind"}),", and optionally ",(0,t.jsx)(n.code,{children:"group"})," for your custom resource"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Spec fields"}),": What inputs users provide when creating instances"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Status fields"}),": What runtime information kro surfaces from managed resources"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Custom types"}),": Reusable type definitions for complex schemas"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Additional printer columns"}),": Custom columns for ",(0,t.jsx)(n.code,{children:"kubectl get"})," output"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"basic-structure",children:"Basic Structure"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-kro",children:"apiVersion: kro.run/v1alpha1\nkind: ResourceGraphDefinition\nmetadata:\n  name: application\nspec:\n  schema:\n    apiVersion: v1alpha1         # Your API version\n    kind: Application            # Your custom resource kind\n\n    spec:                        # User-provided fields\n      name: string\n      replicas: integer\n      image: string\n\n    status:                      # Runtime fields from resources\n      availableReplicas: ${deployment.status.availableReplicas}\n      endpoint: ${service.status.loadBalancer.ingress[0].hostname}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"api-identification",children:"API Identification"}),"\n",(0,t.jsx)(n.h3,{id:"group",children:"Group"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"group"})," field sets the API group for your generated CRD. If omitted, it defaults to ",(0,t.jsx)(n.code,{children:"kro.run"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-kro",children:"schema:\n  apiVersion: v1alpha1\n  kind: Application\n  group: mycompany.io  # Creates applications.mycompany.io CRD\n"})}),"\n",(0,t.jsxs)(n.p,{children:["This allows you to organize your custom APIs under your own domain, making the full API ",(0,t.jsx)(n.code,{children:"mycompany.io/v1alpha1"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"the-spec-section",children:"The spec Section"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"spec"})," section defines what users can configure when they create an instance of your API. These are the input fields that control resource behavior."]}),"\n",(0,t.jsx)(n.h3,{id:"defining-spec-fields",children:"Defining Spec Fields"}),"\n",(0,t.jsxs)(n.p,{children:["kro uses ",(0,t.jsx)(n.a,{href:"/kro/next/api/specifications/simple-schema",children:"SimpleSchema"})," syntax for defining types:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-simpleschema",children:'spec:\n  # Basic types with validation\n  name: string | required=true\n  replicas: integer | default=3 minimum=1 maximum=100\n  enabled: boolean | default=false\n\n  # Structured types\n  ingress:\n    enabled: boolean | default=false\n    host: string | default="example.com"\n    path: string | default="/"\n\n  # Collections\n  env: "map[string]string"\n  ports: "[]integer"\n'})}),"\n",(0,t.jsx)(n.p,{children:"Common validation markers:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"required=true"})," - Field must be provided"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"default=value"})," - Default value if omitted"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"minimum=n"})," / ",(0,t.jsx)(n.code,{children:"maximum=n"})," - Numeric constraints"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:'enum="val1,val2"'})," - Allowed values"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:'pattern="regex"'})," - String pattern validation"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:'description="..."'})," - Field documentation"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["See ",(0,t.jsx)(n.a,{href:"/kro/next/api/specifications/simple-schema",children:"SimpleSchema"})," for complete syntax reference."]}),"\n",(0,t.jsx)(n.h2,{id:"the-status-section",children:"The status Section"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"status"})," section defines what runtime information kro exposes from your managed resources. Status fields use CEL expressions to reference values from the resources in your graph."]}),"\n",(0,t.jsx)(n.h3,{id:"status-fields-with-cel-expressions",children:"Status Fields with CEL Expressions"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-kro",children:'resources:\n  - id: deployment\n    template:\n      apiVersion: apps/v1\n      kind: Deployment\n      # ... deployment spec ...\n\n  - id: service\n    template:\n      apiVersion: v1\n      kind: Service\n      # ... service spec ...\n\nschema:\n  status:\n    # Reference resource fields directly\n    availableReplicas: ${deployment.status.availableReplicas}\n\n    # Extract nested values\n    serviceIP: ${service.spec.clusterIP}\n\n    # Construct composite values\n    endpoint: "http://${service.status.loadBalancer.ingress[0].hostname}"\n'})}),"\n",(0,t.jsx)(n.p,{children:"kro automatically:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Infers proper types"})," from CEL expressions by inspecting what the expression returns (integers, strings, objects, arrays, etc.)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Validates expressions"})," when you create the RGD (not at runtime)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Type-checks"})," expressions against actual Kubernetes schemas"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Updates values"})," whenever the underlying resources change"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"This means status fields have strongly-typed schemas in the generated CRD, not arbitrary objects. If a CEL expression returns an integer, the status field will be typed as an integer in the CRD."}),"\n",(0,t.jsx)(n.h3,{id:"structured-status-fields",children:"Structured Status Fields"}),"\n",(0,t.jsx)(n.p,{children:"Status fields can be scalar values, structured objects, or arrays:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-kro",children:'status:\n  # Scalar values\n  replicas: ${deployment.status.replicas}\n\n  # Structured objects\n  connection:\n    host: ${service.spec.clusterIP}\n    port: ${service.spec.ports[0].port}\n    protocol: "TCP"\n\n  # Arrays\n  endpoints:\n    - ${service.status.loadBalancer.ingress[0].hostname}\n    - ${service.status.loadBalancer.ingress[1].hostname}\n\n  # Nested structures\n  deployment:\n    metadata:\n      name: ${deployment.metadata.name}\n      namespace: ${deployment.metadata.namespace}\n    status:\n      ready: ${deployment.status.readyReplicas}\n      total: ${deployment.status.replicas}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"using-cel-functions-in-status",children:"Using CEL Functions in Status"}),"\n",(0,t.jsx)(n.p,{children:"Status fields support the full power of CEL expressions, including built-in functions:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-kro",children:'status:\n  # Type conversions\n  replicasAsString: ${string(deployment.status.replicas)}\n\n  # Filtering arrays\n  readyPods: ${deployment.status.conditions.filter(c, c.type == "Ready")}\n\n  # Mapping arrays\n  podNames: ${pods.items.map(p, p.metadata.name)}\n\n  # Conditional logic\n  isHealthy: ${deployment.status.availableReplicas >= deployment.spec.replicas}\n\n  # Complex expressions\n  healthStatus: ${deployment.status.availableReplicas >= deployment.spec.replicas ? "healthy" : "degraded"}\n\n  # Combining multiple operations\n  activePodCount: ${pods.items.filter(p, p.status.phase == "Running").size()}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"string-templating-in-status",children:"String Templating in Status"}),"\n",(0,t.jsx)(n.p,{children:"Status fields can use multiple CEL expressions for string construction:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-kro",children:'status:\n  # Single expression - can be any type\n  replicas: ${deployment.status.replicas}  # integer\n\n  # Multiple expressions - must all be strings\n  connectionString: "postgresql://${secret.data.username}:${secret.data.password}@${service.spec.clusterIP}:5432"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"built-in-status-fields",children:"Built-in Status Fields"}),"\n",(0,t.jsx)(n.p,{children:"kro automatically adds two fields to every instance status:"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"conditions"}),": An array tracking the instance state"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-kro",children:'status:\n  conditions:\n    - type: Ready              # Overall readiness\n      status: "True"\n      lastTransitionTime: "..."\n      reason: "..."\n      message: "..."\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"state"}),": A high-level summary"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-kro",children:"status:\n  state: ACTIVE  # ACTIVE | IN_PROGRESS | FAILED | DELETING | ERROR\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"conditions"})," and ",(0,t.jsx)(n.code,{children:"state"})," are reserved fields. kro will override them if you define them in your schema."]})}),"\n",(0,t.jsx)(n.h2,{id:"how-kro-uses-the-schema",children:"How kro Uses the Schema"}),"\n",(0,t.jsx)(n.h3,{id:"1-crd-generation",children:"1. CRD Generation"}),"\n",(0,t.jsx)(n.p,{children:"When you create an RGD, kro converts your SimpleSchema into an OpenAPI v3 schema and generates a CRD:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-kro",children:"# Your RGD schema\nschema:\n  apiVersion: v1alpha1\n  kind: Application\n  spec:\n    name: string | required=true\n"})}),"\n",(0,t.jsx)(n.p,{children:"kro generates:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: apiextensions.k8s.io/v1\nkind: CustomResourceDefinition\nmetadata:\n  name: applications.v1alpha1\nspec:\n  versions:\n    - name: v1alpha1\n      schema:\n        openAPIV3Schema:\n          properties:\n            spec:\n              properties:\n                name:\n                  type: string\n              required: [name]\n"})}),"\n",(0,t.jsx)(n.h3,{id:"2-instance-validation",children:"2. Instance Validation"}),"\n",(0,t.jsx)(n.p,{children:"When users create instances, Kubernetes validates them against the generated CRD schema before kro processes them. This means:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Invalid instances are rejected immediately"}),"\n",(0,t.jsx)(n.li,{children:"Type mismatches are caught at admission time"}),"\n",(0,t.jsx)(n.li,{children:"Required fields are enforced by Kubernetes itself"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"3-status-updates",children:"3. Status Updates"}),"\n",(0,t.jsx)(n.p,{children:"kro continuously evaluates status expressions and updates instance status as resources change. If a deployment's replica count changes, the corresponding status field updates automatically."}),"\n",(0,t.jsx)(n.h2,{id:"custom-types",children:"Custom Types"}),"\n",(0,t.jsx)(n.p,{children:"For complex schemas, you can define reusable custom types:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-kro",children:'schema:\n  types:\n    ContainerConfig:\n      image: string | required=true\n      tag: string | default="latest"\n      env: "map[string]string"\n\n  spec:\n    primary: ContainerConfig\n    sidecars: "[]ContainerConfig"\n'})}),"\n",(0,t.jsx)(n.p,{children:"Custom types are expanded inline when kro generates the CRD."}),"\n",(0,t.jsx)(n.h2,{id:"additional-printer-columns",children:"Additional Printer Columns"}),"\n",(0,t.jsxs)(n.p,{children:["Control what ",(0,t.jsx)(n.code,{children:"kubectl get"})," displays:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-kro",children:"schema:\n  spec:\n    name: string\n    replicas: integer\n\n  status:\n    availableReplicas: ${deployment.status.availableReplicas}\n\n  additionalPrinterColumns:\n    - name: Replicas\n      type: integer\n      jsonPath: .spec.replicas\n\n    - name: Available\n      type: integer\n      jsonPath: .status.availableReplicas\n\n    - name: Age\n      type: date\n      jsonPath: .metadata.creationTimestamp\n"})}),"\n",(0,t.jsx)(n.p,{children:"This produces:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"$ kubectl get applications\nNAME     REPLICAS   AVAILABLE   AGE\nmy-app   5          5           10m\n"})}),"\n",(0,t.jsx)(n.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-kro",children:'apiVersion: kro.run/v1alpha1\nkind: ResourceGraphDefinition\nmetadata:\n  name: web-application\nspec:\n  schema:\n    apiVersion: v1alpha1\n    kind: WebApplication\n\n    spec:\n      # Basic configuration\n      name: string | required=true\n      replicas: integer | default=3 minimum=1\n      image: string | required=true\n\n      # Structured configuration\n      ingress:\n        enabled: boolean | default=false\n        host: string\n        path: string | default="/"\n\n      # Collections\n      env: "map[string]string"\n      ports: "[]integer | default=[80]"\n\n    status:\n      # Resource state\n      availableReplicas: ${deployment.status.availableReplicas}\n      serviceIP: ${service.spec.clusterIP}\n\n      # Conditional fields (only present if ingress enabled)\n      ingressHost: ${ingress.spec.rules[0].host}\n\n    additionalPrinterColumns:\n      - name: Replicas\n        type: integer\n        jsonPath: .spec.replicas\n      - name: Available\n        type: integer\n        jsonPath: .status.availableReplicas\n      - name: Image\n        type: string\n        jsonPath: .spec.image\n\n  resources:\n    - id: deployment\n      template:\n        apiVersion: apps/v1\n        kind: Deployment\n        # ... deployment configuration using ${schema.spec.*} ...\n\n    - id: service\n      template:\n        apiVersion: v1\n        kind: Service\n        # ... service configuration ...\n\n    - id: ingress\n      includeWhen:\n        - ${schema.spec.ingress.enabled}\n      template:\n        apiVersion: networking.k8s.io/v1\n        kind: Ingress\n        # ... ingress configuration ...\n'})}),"\n",(0,t.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"/kro/next/api/specifications/simple-schema",children:"SimpleSchema Reference"})})," - Complete syntax and validation rules"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"/kro/next/docs/concepts/rgd/resource-definitions/resource-basics",children:"Resource Definitions"})})," - Learn how to use schema values in resource templates"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"/kro/next/docs/concepts/rgd/cel-expressions",children:"CEL Expressions"})})," - Master expression syntax for status fields"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>c});var i=s(96540);const t={},a=i.createContext(t);function r(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);