"use strict";(self.webpackChunkkro_docs=self.webpackChunkkro_docs||[]).push([[4122],{82547:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"docs/concepts/instances","title":"Instances","description":"Once kro processes your ResourceGraphDefinition, it creates a new API in your cluster.","source":"@site/versioned_docs/version-0.6.0/docs/concepts/15-instances.md","sourceDirName":"docs/concepts","slug":"/docs/concepts/instances","permalink":"/kro/0.6.0/docs/concepts/instances","draft":false,"unlisted":false,"editUrl":"https://github.com/kubernetes-sigs/kro/tree/main/website/versioned_docs/version-0.6.0/docs/concepts/15-instances.md","tags":[],"version":"0.6.0","sidebarPosition":15,"frontMatter":{"sidebar_position":15},"sidebar":"docsSidebar","previous":{"title":"Simple Schema","permalink":"/kro/0.6.0/docs/concepts/simple-schema"},"next":{"title":"Access Control","permalink":"/kro/0.6.0/docs/concepts/access-control"}}');var r=s(74848),t=s(28453);const c={sidebar_position:15},a="Instances",o={},l=[{value:"Understanding Instances",id:"understanding-instances",level:2},{value:"How kro Manages Instances",id:"how-kro-manages-instances",level:2},{value:"Reactive Reconciliation",id:"reactive-reconciliation",level:3},{value:"Monitoring Your Instances",id:"monitoring-your-instances",level:2},{value:"Understanding Status",id:"understanding-status",level:3},{value:"Debugging Instance Issues",id:"debugging-instance-issues",level:2},{value:"Best Practices",id:"best-practices",level:2}];function d(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"instances",children:"Instances"})}),"\n",(0,r.jsxs)(n.p,{children:["Once ",(0,r.jsx)(n.strong,{children:"kro"})," processes your ResourceGraphDefinition, it creates a new API in your cluster.\nUsers can then create instances of this API to deploy resources in a consistent,\ncontrolled way."]}),"\n",(0,r.jsx)(n.h2,{id:"understanding-instances",children:"Understanding Instances"}),"\n",(0,r.jsx)(n.p,{children:"An instance represents your deployed application. When you create an instance,\nyou're telling kro \"I want this set of resources running in my cluster\". The\ninstance contains your configuration values and serves as the single source of\ntruth for your application's desired state. Here's an example instance of our\nWebApplication API:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"apiVersion: kro.run/v1alpha1\nkind: WebApplication\nmetadata:\n  name: my-app\nspec:\n  name: web-app\n  image: nginx:latest\n  ingress:\n    enabled: true\n"})}),"\n",(0,r.jsx)(n.p,{children:"When you create this instance, kro:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Creates all required resources (Deployment, Service, Ingress)"}),"\n",(0,r.jsx)(n.li,{children:"Configures them according to your specification"}),"\n",(0,r.jsx)(n.li,{children:"Manages them as a single unit"}),"\n",(0,r.jsx)(n.li,{children:"Keeps their status up to date"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"how-kro-manages-instances",children:"How kro Manages Instances"}),"\n",(0,r.jsx)(n.p,{children:"kro uses the standard Kubernetes reconciliation pattern to manage instances:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Observe"}),": Watches for changes to your instance or its resources"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Compare"}),": Checks if current state matches desired state"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Act"}),": Creates, updates, or deletes resources as needed"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Report"}),": Updates status to reflect current state"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This continuous loop ensures your resources stay in sync with your desired\nstate, providing features like:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Self-healing"}),"\n",(0,r.jsx)(n.li,{children:"Automatic updates"}),"\n",(0,r.jsx)(n.li,{children:"Consistent state management"}),"\n",(0,r.jsx)(n.li,{children:"Status tracking"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"reactive-reconciliation",children:"Reactive Reconciliation"}),"\n",(0,r.jsx)(n.p,{children:"kro automatically watches all resources managed by an instance and triggers\nreconciliation when any of them change. This means:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Child Resource Changes"}),": When a managed resource (like a Deployment or Service) is\nmodified, kro detects the change and reconciles the instance to ensure it matches\nthe desired state defined in your ResourceGraphDefinition."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Drift Detection"}),": If a resource is manually modified or deleted, kro will detect\nthe drift and automatically restore it to the desired state."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Dependency Updates"}),": Changes to resources propagate through the dependency graph,\nensuring all dependent resources are updated accordingly."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This reactive behavior ensures your instances maintain consistency without requiring\nmanual intervention or periodic full reconciliations."}),"\n",(0,r.jsx)(n.h2,{id:"monitoring-your-instances",children:"Monitoring Your Instances"}),"\n",(0,r.jsx)(n.p,{children:"KRO provides rich status information for every instance:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"$ kubectl get webapplication my-app\nNAME     STATUS    SYNCED   AGE\nmy-app   ACTIVE    true     30s\n"})}),"\n",(0,r.jsx)(n.p,{children:"For detailed status, check the instance's YAML:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'status:\n  state: ACTIVE # High-level instance state\n  availableReplicas: 3 # Status from Deployment\n  conditions: # Detailed status conditions\n    - lastTransitionTime: "2025-08-08T00:03:46Z"\n      message: instance is properly managed with finalizers and labels\n      observedGeneration: 1\n      reason: Managed\n      status: "True"\n      type: InstanceManaged\n    - lastTransitionTime: "2025-08-08T00:03:46Z"\n      message: runtime graph created and all resources resolved\n      observedGeneration: 1\n      reason: Resolved\n      status: "True"\n      type: GraphResolved\n    - lastTransitionTime: "2025-08-08T00:03:46Z"\n      message: all resources are created and ready\n      observedGeneration: 1\n      reason: AllResourcesReady\n      status: "True"\n      type: ResourcesReady\n    - lastTransitionTime: "2025-08-08T00:03:46Z"\n      message: ""\n      observedGeneration: 1\n      reason: Ready\n      status: "True"\n      type: Ready\n'})}),"\n",(0,r.jsx)(n.h3,{id:"understanding-status",children:"Understanding Status"}),"\n",(0,r.jsx)(n.p,{children:"Every instance includes:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"State"}),": High-level status"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ACTIVE"}),": Indicates that the instance is successfully running and active."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"IN_PROGRESS"}),": Indicates that the instance is currently being processed or reconciled."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"FAILED"}),": Indicates that the instance has failed to be properly reconciled."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"DELETING"}),": Indicates that the instance is in the process of being deleted."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ERROR"}),": Indicates that an error occurred during instance processing."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Conditions"}),": Detailed status information structured hierarchically"]}),"\n",(0,r.jsxs)(n.p,{children:["kro provides a top-level ",(0,r.jsx)(n.code,{children:"Ready"})," condition that reflects the overall instance health. This condition is supported by three sub-conditions that track different phases of the reconciliation process:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"InstanceManaged"}),": Instance finalizers and labels are properly set"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Ensures the instance is under kro's management"}),"\n",(0,r.jsx)(n.li,{children:"Tracks whether cleanup handlers (finalizers) are configured"}),"\n",(0,r.jsx)(n.li,{children:"Confirms instance is labeled with ownership and version information"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"GraphResolved"}),": Runtime graph has been created and resources resolved"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Validates that the resource graph has been successfully parsed"}),"\n",(0,r.jsx)(n.li,{children:"Confirms all resource templates have been resolved"}),"\n",(0,r.jsx)(n.li,{children:"Ensures dependencies between resources are properly understood"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"ResourcesReady"}),": All resources in the graph are created and ready"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Tracks the creation and readiness of all managed resources"}),"\n",(0,r.jsx)(n.li,{children:"Monitors the health of resources in topological order"}),"\n",(0,r.jsx)(n.li,{children:"Reports when all resources have reached their ready state"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"Ready"}),": Instance is fully operational (top-level condition)"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Aggregates the state of all sub-conditions"}),"\n",(0,r.jsx)(n.li,{children:"Only becomes True when all sub-conditions are True"}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"The primary condition to monitor and wait on for instance health"})}),"\n",(0,r.jsx)(n.li,{children:"Use this condition in automation, CI/CD, and health checks"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["Always use the ",(0,r.jsx)(n.code,{children:"Ready"})," condition to determine instance health. The sub-conditions (",(0,r.jsx)(n.code,{children:"InstanceManaged"}),", ",(0,r.jsx)(n.code,{children:"GraphResolved"}),", ",(0,r.jsx)(n.code,{children:"ResourcesReady"}),") are provided for debugging purposes and may change in future versions. kro reserves the right to add, remove, or modify sub-conditions without breaking compatibility as long as the ",(0,r.jsx)(n.code,{children:"Ready"})," condition behavior remains stable."]})}),"\n",(0,r.jsx)(n.p,{children:"Each condition includes:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"observedGeneration"}),": Tracks which generation of the instance this condition reflects"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"lastTransitionTime"}),": When the condition last changed state"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"reason"}),": A programmatic identifier for the condition state"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"message"}),": A human-readable description of the current state"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Resource Status"}),": Status from your resources"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Values you defined in your ResourceGraphDefinition's status section"}),"\n",(0,r.jsx)(n.li,{children:"Automatically updated as resources change"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"debugging-instance-issues",children:"Debugging Instance Issues"}),"\n",(0,r.jsx)(n.p,{children:"When an instance is not in the expected state, the condition hierarchy helps you quickly identify where the problem occurred:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Check the Ready condition first"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl get <your-kind> <instance-name> -o jsonpath='{.status.conditions[?(@.type==\"Ready\")]}'\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"If Ready is False, check the sub-conditions"})," to identify which phase failed:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["If ",(0,r.jsx)(n.code,{children:"InstanceManaged"})," is False: Check if there are issues with finalizers or instance labels"]}),"\n",(0,r.jsxs)(n.li,{children:["If ",(0,r.jsx)(n.code,{children:"GraphResolved"})," is False: The resource graph could not be created - check the ResourceGraphDefinition for syntax errors or invalid CEL expressions"]}),"\n",(0,r.jsxs)(n.li,{children:["If ",(0,r.jsx)(n.code,{children:"ResourcesReady"})," is False: One or more managed resources failed to become ready - check the error message for which resource failed"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Use kubectl describe"})," to see all conditions and recent events:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl describe <your-kind> <instance-name>\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Check the observedGeneration"})," field in conditions:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["If ",(0,r.jsx)(n.code,{children:"observedGeneration"})," is less than ",(0,r.jsx)(n.code,{children:"metadata.generation"}),", the controller hasn't processed the latest changes yet"]}),"\n",(0,r.jsx)(n.li,{children:"If they match, the conditions reflect the current state of your instance"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Version Control"}),": Keep your instance definitions in version control\nalongside your application code. This helps track changes, rollback when\nneeded, and maintain configuration history."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Use Labels Effectively"}),": Add meaningful labels to your instances for better\norganization, filtering, and integration with other tools. kro propagates\nlabels to the sub resources for easy identification."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Active Monitoring"}),': Regularly check instance status beyond just "Running".\nWatch conditions, resource status, and events to catch potential issues early\nand understand your application\'s health. Focus on the ',(0,r.jsx)(n.code,{children:"Ready"})," condition and\nits sub-conditions to understand the reconciliation state."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Monitor observedGeneration"}),": When making changes to an instance, verify that\n",(0,r.jsx)(n.code,{children:"observedGeneration"})," in the conditions matches ",(0,r.jsx)(n.code,{children:"metadata.generation"})," to ensure\nkro has processed your changes."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Leverage Reactive Reconciliation"}),": kro automatically detects and corrects drift\nin managed resources. If you need to make manual changes to resources, update the\ninstance specification instead to ensure changes persist and align with your\ndesired state."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Regular Reviews"}),": Periodically review your instance configurations to\nensure they reflect current requirements and best practices. Update resource\nrequests, limits, and other configurations as your application needs evolve."]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>a});var i=s(96540);const r={},t=i.createContext(r);function c(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);